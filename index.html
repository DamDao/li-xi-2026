<!doctype html>
<html lang="vi" class="h-full">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L·ªôc Xu√¢n - G·ª≠i Trao Y√™u Th∆∞∆°ng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&amp;family=Be+Vietnam+Pro:wght@300;400;500;600&amp;display=swap"
        rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@600;700;900&display=swap"
        rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link href="src/css/style.css" rel="stylesheet" />
    <link href="src/css/phao-hoa.css" rel="stylesheet" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "tet-red": "#8B0000",
                        "tet-red-light": "#B22222",
                        "tet-gold": "#FFD700",
                        "tet-gold-dark": "#DAA520",
                        "tet-cream": "#FFF8DC",
                    },
                    fontFamily: {
                        heading: ["Playfair Display", "serif"],
                        body: ["Be Vietnam Pro", "sans-serif"],
                    },
                },
            },
        };
    </script>
    <style>
        /* Th√™m v√†o ph·∫ßn <head> */
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        
        /* Animation cho scratch overlay */
        .scratched {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        
        /* Animation cho money reveal */
        .money-reveal {
            animation: moneyPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes moneyPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* CSS cho COVER M·ªöI */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.4); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes lantern-sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .outer-card-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 215, 0, 0.3);
        }

        .inner-card-frame {
            border: 2px solid;
            border-image: linear-gradient(135deg, #ffd700, #b8860b, #ffd700, #daa520, #ffd700) 1;
            background: linear-gradient(180deg, rgba(139, 0, 0, 0.95) 0%, rgba(80, 0, 0, 0.98) 100%);
        }

        .text-shadow-gold {
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .text-shadow-dark {
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .float-animation { animation: float 4s ease-in-out infinite; }
        .sparkle { animation: sparkle 2s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

        .shimmer-text {
            background: linear-gradient(90deg, #ffd700, #fff8dc, #ffd700, #fff8dc, #ffd700);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
        }

        .lantern {
            animation: lantern-sway 3s ease-in-out infinite;
            transform-origin: top center;
        }

        /* .lantern-delay-1 { animation-delay: 0.3s; } */

        .decorative-corner {
            position: absolute;
            width: 80px;
            height: 80px;
            opacity: 0.8;
        }

        .corner-tl { top: 10px; left: 10px; }
        .corner-tr { top: 10px; right: 10px; transform: scaleX(-1); }
        .corner-bl { bottom: 10px; left: 10px; transform: scaleY(-1); }
        .corner-br { bottom: 10px; right: 10px; transform: scale(-1, -1); }

        .img-fallback {
            background: linear-gradient(135deg, #8B0000, #FFD700);
        }
    </style>

    <style>
        /* Canvas c√†o l√¨ x√¨ */
        #scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
            border-radius: 0.5rem;
        }

        #scratch-canvas:active {
            cursor: grabbing;
        }

        #scratch-area {
            position: relative;
            user-select: none;
            -webkit-user-select: none;
        }
    </style>

    <style>
        input.bg-yellow-100 {
            transition: background-color 0.5s ease;
        }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body class="h-full font-body">
    <div id="app-wrapper" class="h-full w-full overflow-auto bg-pattern relative">
        <!-- Decorative Elements -->
        <div class="absolute top-4 left-4 text-4xl lantern opacity-80">üèÆ</div>
        <div class="absolute top-4 right-4 text-4xl lantern opacity-80" style="animation-delay: -2s">
            üèÆ
        </div>
        <div id="settings-btn" class="absolute top-6 right-20 text-4xl lantern opacity-80 cursor-pointer z-20" style="animation-delay: -2s">
            <svg xmlns="http://www.w3.org/2000/svg" height="30" width="30" viewBox="0 0 640 640">
                <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
                <path fill="#ffffff" d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z"/></svg>    
        </div>
        <div class="absolute top-20 left-1/4 text-2xl floating opacity-60">
            üå∏
        </div>
        <div class="absolute top-32 right-1/4 text-xl floating opacity-50" style="animation-delay: -1s">
            ‚ú®
        </div>
        <div class="absolute bottom-20 left-16 text-3xl floating opacity-70" style="animation-delay: -3s">
            üéã
        </div>
        <div class="absolute bottom-32 right-20 text-2xl floating opacity-60" style="animation-delay: -2s">
            üå∫
        </div>
        <!-- Sparkle decorations -->
        <div class="absolute top-1/4 left-10 w-2 h-2 bg-tet-gold rounded-full sparkle"></div>
        <div class="absolute top-1/3 right-16 w-1.5 h-1.5 bg-tet-gold rounded-full sparkle"
            style="animation-delay: -0.5s"></div>
        <div class="absolute bottom-1/4 left-20 w-2 h-2 bg-tet-gold rounded-full sparkle" style="animation-delay: -1s">
        </div>

        <!-- Main Content -->
        <div class="min-h-full flex flex-col items-center justify-center px-4 py-8 relative z-10">
            <!-- Header Section -->
            <div class="text-center mb-8 md:mb-12">
                <!-- Tagline -->
                <p id="tagline" class="text-tet-cream/80 text-sm md:text-base tracking-widest mb-4 font-light">
                    G·ª≠i trao y√™u th∆∞∆°ng ‚Äì Nh·∫≠n l·ªôc an khang
                </p>
                <!-- Main Heading -->
                <h1 id="main-heading" class="font-heading text-3xl md:text-5xl lg:text-6xl font-bold gold-shimmer mb-2">
                    Ng∆∞·ªùi trao ƒëang g·ª≠i l·ªôc xu√¢n cho..?
                </h1>
                <!-- Decorative line -->
                <div class="flex items-center justify-center gap-3 mt-4">
                    <div class="w-16 md:w-24 h-px bg-gradient-to-r from-transparent via-tet-gold to-transparent"></div>
                    <span class="text-tet-gold text-xl">‚ùÄ</span>
                    <div class="w-16 md:w-24 h-px bg-gradient-to-r from-transparent via-tet-gold to-transparent"></div>
                </div>
            </div>

            <!-- Cards Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 max-w-5xl mx-auto mb-8 md:mb-12">
                <!-- Card 1: √îng B√† -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="ong-ba">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë¥üëµ
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        √îng B√†
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        K√≠nh ch√∫c s·ª©c kh·ªèe
                    </p>
                </button>

                <!-- Card 2: B·ªë M·∫π -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="bo-me">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë®‚Äçüë©‚Äçüëß
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        B·ªë M·∫π
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Bi·∫øt ∆°n d∆∞·ª°ng d·ª•c
                    </p>
                </button>

                <!-- Card 3: Anh Ch·ªã Em -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="anh-chi-em">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë´
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Anh Ch·ªã Em
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        ƒê·ªìng h√†nh b√™n nhau
                    </p>
                </button>

                <!-- Card 4: Con C√°i -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="con-cai">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë∂
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Con C√°i
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Mong con kh√¥n l·ªõn
                    </p>
                </button>

                <!-- Card 5: B·∫°n B√® -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="ban-be">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        ü§ù
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        B·∫°n B√®
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Tri k·ª∑ ƒë·ªìng h√†nh
                    </p>
                </button>

                <!-- Card 6: ƒê·ªìng Nghi·ªáp -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="dong-nghiep">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üíº
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        ƒê·ªìng Nghi·ªáp
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Th√†nh c√¥ng chung
                    </p>
                </button>

                <!-- Card 7: Th·∫ßy C√¥ -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="thay-co">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üìö
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Th·∫ßy C√¥
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        ∆†n d·∫°y d·ªó s√¢u
                    </p>
                </button>

                <!-- Card 8: Ng∆∞·ªùi Th∆∞∆°ng -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="nguoi-thuong">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üíï
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Ng∆∞·ªùi Th∆∞∆°ng
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Y√™u th∆∞∆°ng tr·ªçn ƒë·ªùi
                    </p>
                </button>
            </div>

            <!-- Selected Recipient Display -->
            <div id="selection-display" class="hidden text-center mb-6 animate-pulse">
                <p class="text-tet-cream text-lg">
                    B·∫°n ƒëang g·ª≠i l·ªôc xu√¢n ƒë·∫øn:
                    <span id="selected-name" class="text-tet-gold font-semibold"></span>
                </p>
            </div>

            <!-- Continue Button -->
            <button id="continue-btn"
                class="hidden bg-gradient-to-r from-tet-gold-dark via-tet-gold to-tet-gold-dark text-tet-red font-semibold px-8 py-3 rounded-full text-lg shadow-lg hover:shadow-tet-gold/50 hover:scale-105 transition-all duration-300 mb-8">
                Chao g·ª≠i y√™u th∆∞∆°ng ‚ú®
            </button>

            <!-- Envelopes Grid (hidden by default) -->
            <div id="envelopes-container" class="hidden max-w-6xl mx-auto w-full px-4">
                <div class="text-center mb-8">
                    <h2 class="font-heading text-2xl md:text-3xl font-bold gold-shimmer mb-4">
                        24 Bao L√¨ X√¨ Y√™u Th∆∞∆°ng
                    </h2>
                    <p class="text-tet-cream/70 text-sm md:text-base">
                        Ch·ªçn m·ªôt bao l√¨ x√¨ ƒë·ªÉ g·ª≠i trao y√™u th∆∞∆°ng
                    </p>
                </div>

                <div id="envelopes-grid"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-5 mb-12">
                    <!-- 24 envelopes will be generated here -->
                </div>

                <div class="text-center">
                    <button id="back-btn"
                        class="bg-tet-red-light text-tet-cream font-medium px-6 py-2 rounded-full hover:bg-tet-red transition-all duration-300">
                        ‚Üê Quay l·∫°i ch·ªçn m·ª•c ng∆∞·ªùi nh·∫≠n
                    </button>
                </div>
            </div>

            <!-- Footer -->
            <footer class="text-center">

                <button id="launchBtn" title="B·∫Øn ph√°o hoa">üéÜ</button>
                <canvas id="fireworksCanvas"></canvas>

                <p id="footer-text" class="font-heading text-tet-gold text-xl md:text-2xl mb-2">
                    L·ªôc Xu√¢n 2026
                </p>
                <p class="text-tet-cream/60 text-xs md:text-sm font-light tracking-wide">
                    Trao g·ª≠i y√™u th∆∞∆°ng ‚Ä¢ ƒê√≥n nh·∫≠n an khang
                </p>
                <div class="flex items-center justify-center gap-2 mt-3 text-tet-gold/90">
                    <span>üßß</span>
                    <span class="text-xs">Ch√∫c M·ª´ng NƒÉm M·ªõi</span>
                    <span>üßß</span>
                </div>
            </footer>
        </div>
    </div>

    <!-- Modal T√¢m Th∆∞ & L·ªôc Xu√¢n -->
    <div id="heart-letter-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/70"></div>
        <div class="relative bg-gradient-to-br from-red-50 to-amber-50 w-full max-w-4xl rounded-xl shadow-xl overflow-hidden border-2 border-tet-gold">
            
            <!-- ===== THI·ªÜP B√äN NGO√ÄI (COVER) M·ªöI ===== -->
            <div id="card-cover" class="absolute inset-0 z-50 flex items-center justify-center">
                <div class="relative z-10 max-w-4xl w-full">
                    <div class="relative bg-gradient-to-b from-red-900/90 to-red-950/95 rounded-3xl p-1 shadow-2xl outer-card-shadow">
                        <div class="relative rounded-2xl p-6 md:p-8 inner-card-frame">
                            <svg class="decorative-corner corner-tl" viewbox="0 0 80 80">
                                <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                                <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                                <circle cx="8" cy="8" r="3" fill="#FFD700" />
                                <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                            </svg>
                            <svg class="decorative-corner corner-tr" viewbox="0 0 80 80">
                                <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                                <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                                <circle cx="8" cy="8" r="3" fill="#FFD700" />
                                <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                            </svg>
                            <svg class="decorative-corner corner-bl" viewbox="0 0 80 80">
                                <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                                <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                                <circle cx="8" cy="8" r="3" fill="#FFD700" />
                                <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                            </svg>
                            <svg class="decorative-corner corner-br" viewbox="0 0 80 80">
                                <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                                <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                                <circle cx="8" cy="8" r="3" fill="#FFD700" />
                                <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                            </svg>

                            <div class="text-center relative z-10 py-4">

                                <div class="inline-block mb-4">
                                    <div class="relative">
                                        <div class="absolute inset-0 bg-gradient-to-r from-yellow-600 to-yellow-400 blur-lg opacity-50 rounded-full"></div>
                                        <div class="relative bg-gradient-to-br from-yellow-500 via-yellow-400 to-yellow-600 text-red-900 font-bold text-lg px-6 py-2 rounded-full shadow-lg text-shadow-gold">
                                            üê¥ NƒÇM B√çNH NG·ªå 2026 üê¥
                                        </div>
                                    </div>
                                </div>

                                <h1 id="main-title" class="font-heading text-3xl md:text-4xl font-bold mb-3 shimmer-text leading-tight">
                                    CH√öC M·ª™NG NƒÇM M·ªöI
                                </h1>

                                <div class="flex items-center justify-center gap-3 my-4">
                                    <div class="h-px w-16 bg-gradient-to-r from-transparent to-yellow-500"></div>
                                    <span class="text-yellow-400 text-2xl">‚ùß</span>
                                    <div class="h-px w-16 bg-gradient-to-l from-transparent to-yellow-500"></div>
                                </div>

                                <p id="subtitle" class="font-dancing text-2xl md:text-3xl text-yellow-200 mb-6 text-shadow-dark">
                                    An Khang Th·ªãnh V∆∞·ª£ng
                                </p>

                                <p class="text-yellow-100/90 text-sm md:text-base mb-6 px-4 leading-relaxed">
                                    K√≠nh ch√∫c qu√Ω v·ªã m·ªôt nƒÉm m·ªõi<br />
                                    <span class="text-yellow-300 font-semibold">V·∫°n S·ª± Nh∆∞ √ù ‚Ä¢ T√†i L·ªôc ƒê·∫ßy Nh√†</span>
                                </p>

                                <button id="open-card-btn" class="relative group pulse-glow rounded-full overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                    <div class="relative bg-gradient-to-r from-yellow-500 via-yellow-400 to-yellow-500 text-red-900 font-bold px-10 py-2 rounded-full transition-all duration-300 group-hover:scale-105 text-shadow-gold">
                                        <span class="flex items-center gap-2">
                                            <span>‚úâÔ∏è</span> <span>M·ªû THI·ªÜP</span> <span>‚úâÔ∏è</span>
                                        </span>
                                    </div>
                                </button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ===== END COVER M·ªöI ===== -->

            <!-- N·ªôi dung t√¢m th∆∞ -->
            <!-- Header -->
            <div class="bg-gradient-to-r from-tet-red to-tet-red-light py-4 px-6 text-center">
                <h2 class="font-heading text-3xl font-bold text-tet-gold">T√ÇM TH∆Ø & L·ªòC XU√ÇN</h2>
                <p class="text-tet-cream/90 text-sm mt-1">Xu√¢n ·∫§t T·ªµ 2025 - An Khang Th·ªãnh V∆∞·ª£ng</p>
            </div>
            
            <!-- Content -->
            <div class="p-6 md:p-8">
                <!-- L·ªùi ch√∫c -->
                <div class="text-center mb-3  border-b-2 pb-6  border-tet-gold/30">
                    <h3 class="font-heading text-2xl font-bold text-tet-red mb-3">Ch√∫c M·ª´ng NƒÉm M·ªõi!</h3>
                    <p class="text-gray-700 text-lg leading-relaxed">
                        Ch√∫c b·∫°n m·ªôt nƒÉm m·ªõi tr√†n ƒë·∫ßy s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† th√†nh c√¥ng. 
                        Mong r·∫±ng nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi b·∫°n v√† gia ƒë√¨nh.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ph·∫ßn c√†o l·ªôc xu√¢n -->
                    <div class="">
                        <div class="rounded-lg p-2">
                        <p class="text-sm text-gray-600 italic mb-1">Ch√∫c m·ª´ng nƒÉm m·ªõi ·∫§t T·ªµ 2025</p>
                        <div id="scratch-area" class="bg-gradient-to-r from-gray-200 to-gray-300 h-16 rounded-lg relative overflow-hidden flex items-center justify-center">
                            <!-- N·ªôi dung b√™n d∆∞·ªõi - s·ªë ti·ªÅn -->
                            <div id="lucky-amount" class="absolute inset-0 flex items-center justify-center text-xl md:text-2xl font-bold text-tet-red">
                                <span id="money-display"></span>
                            </div>
                            <!-- Canvas c√†o -->
                            <canvas id="scratch-canvas"></canvas>
                        </div>
                    </div>
                    </div>
                    
                    <!-- Ng∆∞·ªùi g·ª≠i -->
                    <div class="text-end">
                        <p class="text-sm text-gray-600 italic mb-1">Ng∆∞·ªùi g·ª≠i</p>
                        <p class="font-dancing text-3xl font-bold text-tet-red mb-1">ƒê√†m ƒê√¨nh ƒê√†o</p>
                    </div>
                </div>
                
                <!-- N√∫t ƒë√≥ng -->
                <div class="text-center mt-5">
                    <button id="close-modal" class="bg-tet-red text-tet-cream font-semibold px-8 py-3 rounded-full hover:bg-tet-red-light transition-all duration-300">
                        Tr√¢n Tr·ªçng C·∫£m ∆†n
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal C√†i ƒê·∫∑t M·ªánh Gi√° -->
    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/70"></div>
        
        <!-- Form Content -->
        <div class="relative bg-gradient-to-br from-red-50 to-amber-50 w-full max-w-4xl max-h-[90vh] rounded-xl shadow-2xl overflow-hidden border-2 border-tet-gold">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-tet-red to-tet-red-light py-4 px-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="font-heading text-2xl md:text-3xl font-bold text-tet-gold">L·ªôc Xu√¢n ƒê·∫ßu NƒÉm</h2>
                        <p class="text-tet-cream/90 text-xs md:text-sm mt-1">T√πy ch·ªânh m·ªánh gi√° cho t·ª´ng ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi nh·∫≠n</p>
                    </div>
                    <button id="close-settings" class="text-tet-cream hover:text-tet-gold text-3xl leading-none">√ó</button>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="settings-form-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Form s·∫Ω ƒë∆∞·ª£c generate t·ª± ƒë·ªông b·∫±ng JavaScript -->
                </div>
            </div>
            
            <!-- Footer -->
            <div class="bg-gray-100 px-6 py-4 flex justify-between items-center border-t">
                <button id="reset-settings" class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition">
                    üîÑ Reset M·∫∑c ƒê·ªãnh
                </button>
                <button id="save-settings" class="bg-tet-red text-tet-cream font-semibold px-8 py-2 rounded-lg hover:bg-tet-red-light transition">
                    üíæ L∆∞u C√†i ƒê·∫∑t
                </button>
            </div>
        </div>
    </div>
    <script src="src/js/helper.js"></script>
    <script src="src/js/script.js"></script>
    <script>
        const defaultConfig = {
            tagline: "G·ª≠i trao y√™u th∆∞∆°ng ‚Äì Nh·∫≠n l·ªôc an khang",
            main_heading: "Ng∆∞·ªùi trao ƒëang g·ª≠i l·ªôc xu√¢n cho..?",
            footer_text: "L·ªôc Xu√¢n 2026",
            background_color: "#1a0a0a",
            card_color: "#8B0000",
            text_color: "#FFF8DC",
            gold_color: "#FFD700",
            accent_color: "#B22222",
        };

        // ===== DEBUG MODE =====
        const DEBUG_MODE = true; // ƒê·ªïi th√†nh false khi deploy production
        // ======================

        let selectedRecipient = null;
        let isModalOpen = false; 
        const recipientNames = {
            "ong-ba": "√îng B√†",
            "bo-me": "B·ªë M·∫π",
            "anh-chi-em": "Anh Ch·ªã Em",
            "con-cai": "Con C√°i",
            "ban-be": "B·∫°n B√®",
            "dong-nghiep": "ƒê·ªìng Nghi·ªáp",
            "thay-co": "Th·∫ßy C√¥",
            "nguoi-thuong": "Ng∆∞·ªùi Th∆∞∆°ng",
        };
        const recipientIcons = {
            "ong-ba": "üë¥üëµ",
            "bo-me": "üë®‚Äçüë©‚Äçüëß",
            "anh-chi-em": "üë´",
            "con-cai": "üë∂",
            "ban-be": "ü§ù",
            "dong-nghiep": "üíº",
            "thay-co": "üìö",
            "nguoi-thuong": "üíï",
        };


        // Card selection logic
        document.querySelectorAll(".card-envelope").forEach((card) => {
            card.addEventListener("click", function () {
                // Remove selection from all cards
                document.querySelectorAll(".card-envelope").forEach((c) => {
                    c.classList.remove("selected-card");
                });

                // Add selection to clicked card
                this.classList.add("selected-card");
                selectedRecipient = this.dataset.recipient;

                // Show selection display
                const selectionDisplay = document.getElementById("selection-display");
                const selectedName = document.getElementById("selected-name");
                const continueBtn = document.getElementById("continue-btn");

                selectedName.textContent = recipientNames[selectedRecipient];
                selectionDisplay.classList.remove("hidden");
                continueBtn.classList.remove("hidden");
            });
        });

        // Continue button click - Show 24 envelopes
        document
            .getElementById("continue-btn")
            .addEventListener("click", function () {
                const envelopesGrid = document.getElementById("envelopes-grid");
                envelopesGrid.innerHTML = "";

                if (selectedRecipient) {
                    // Hide main content
                    document.querySelector(".grid.grid-cols-2").classList.add("hidden");
                    document
                        .getElementById("selection-display")
                        .classList.add("hidden");
                    this.classList.add("hidden");

                    // Show envelopes container
                    const envelopesContainer = document.getElementById(
                        "envelopes-container",
                    );
                    envelopesContainer.classList.remove("hidden");

                    // Generate 24 envelopes
                    const envelopesGrid = document.getElementById("envelopes-grid");
                    envelopesGrid.innerHTML = "";

                    // Hi·ªÉn th·ªã 24 bao l√¨ x√¨ m·ªõi
                    for (let i = 1; i <= 24; i++) {
                        envelopesGrid.appendChild(createEnvelope(i));
                    }
                }
            });

        // Back button - Return to main selection
        document
            .getElementById("back-btn")
            .addEventListener("click", function () {
                // Hide envelopes container
                document
                    .getElementById("envelopes-container")
                    .classList.add("hidden");

                // Show main content
                document
                    .querySelector(".grid.grid-cols-2")
                    .classList.remove("hidden");
                document
                    .getElementById("selection-display")
                    .classList.remove("hidden");
                document.getElementById("continue-btn").classList.remove("hidden");
            });

        // =========== PH·∫¶N T·∫†O BAO L√å X√å M·ªöI ===========
        const luckyMessages = [
            "Ph√°t T√†i Ph√°t L·ªôc",
            "V·∫°n S·ª± Nh∆∞ √ù",
            "An Khang Th·ªãnh V∆∞·ª£ng",
            "T√†i L·ªôc D·ªìi D√†o",
            "S·ª©c Kh·ªèe D·ªìi D√†o",
            "H·∫°nh Ph√∫c Vi√™n M√£n",
            "C√¥ng Th√†nh Danh To·∫°i",
            "M√£ ƒê√°o Th√†nh C√¥ng",
            "Kim Ng·ªçc M√£n ƒê∆∞·ªùng",
            "Ph√∫c L·ªôc Song To√†n",
            "Thu·∫≠n Bu·ªìm Xu√¥i Gi√≥",
            "B√¨nh An H·∫°nh Ph√∫c",
        ];

        const luckySymbols = ["Á¶è", "Á¶Ñ", "ÂØø", "Âñú", "Ë≤°", "Âêâ", "Á••", "Áôº"];

        // Bi·∫øn global ƒë·ªÉ qu·∫£n l√Ω timeout cho t·∫•t c·∫£ envelopes
        let globalClickTimeout = null;
        let lastClickedEnvelope = null;

        function createEnvelope(number) {
            const envelope = document.createElement("div");
            envelope.className = "envelope-item";

            const luckyMessage = luckyMessages[(number - 1) % luckyMessages.length];
            const luckySymbol = luckySymbols[(number - 1) % luckySymbols.length];

            // X√°c ƒë·ªãnh lo·∫°i l√¨ x√¨ d·ª±a tr√™n s·ªë th·ª© t·ª±
            const envelopeTypes = [
                "", // M√†u ƒë·ªè truy·ªÅn th·ªëng
                "envelope-blue", // Xanh d∆∞∆°ng
                "envelope-gold-light", // Xanh l√°
                "envelope-purple", // T√≠m
                "envelope-gold", // V√†ng ƒë·∫≠m
                "",
                // t·ª´ng row
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
            ];

            const envelopeType = envelopeTypes[(number - 1) % envelopeTypes.length];

            // X√°c ƒë·ªãnh lo·∫°i seal
            let sealClass = "gold-seal";
            if (number % 3 === 0) {
                sealClass = "gold-seal silver-seal";
            } else if (number % 5 === 0) {
                sealClass = "gold-seal bronze-seal";
            }

            envelope.innerHTML = `
                <div class="envelope-body">
                    <div class="pattern-overlay"></div>
                    <div class="shimmer"></div>
                    
                    <!-- Corner Decorations -->
                    <div class="corner-decor top-left"></div>
                    <div class="corner-decor top-right"></div>
                    <div class="corner-decor bottom-left"></div>
                    <div class="corner-decor bottom-right"></div>
                    
                    <!-- Flower Decorations -->
                    <div class="flower-decor flower-top-left">üå∏</div>
                    <div class="flower-decor flower-top-right">üå∏</div>
                    <div class="flower-decor flower-bottom-left">üå∏</div>
                    <div class="flower-decor flower-bottom-right">üå∏</div>
                    
                    <!-- Ornamental Bands -->
                    <div class="ornament-pattern ornament-top"></div>
                    <div class="ornament-pattern ornament-bottom"></div>
                    
                    <!-- Wave Patterns -->
                    <div class="wave-pattern wave-top"></div>
                    <div class="wave-pattern wave-bottom"></div>
                    
                    <!-- Diamond Patterns -->
                    <div class="diamond-pattern diamond-1"></div>
                    <div class="diamond-pattern diamond-2"></div>
                    <div class="diamond-pattern diamond-3"></div>
                    <div class="diamond-pattern diamond-4"></div>
                    
                    <!-- Lantern Decorations -->
                    <div class="lantern-decor lantern-left">üèÆ</div>
                    <div class="lantern-decor lantern-right">üèÆ</div>
                    
                    <!-- Gold Dots -->
                    <div class="gold-dots" style="top: 28%; left: 25%;"></div>
                    <div class="gold-dots" style="top: 28%; right: 25%;"></div>
                    <div class="gold-dots" style="top: 40%; left: 20%;"></div>
                    <div class="gold-dots" style="top: 40%; right: 20%;"></div>
                    <div class="gold-dots" style="bottom: 28%; left: 25%;"></div>
                    <div class="gold-dots" style="bottom: 28%; right: 25%;"></div>
                    <div class="gold-dots" style="bottom: 40%; left: 20%;"></div>
                    <div class="gold-dots" style="bottom: 40%; right: 20%;"></div>
                    
                    <!-- Cloud Patterns -->
                    <div class="cloud-pattern cloud-1"></div>
                    <div class="cloud-pattern cloud-2"></div>
                    
                    <!-- Lucky Knot -->
                    <div class="lucky-knot"></div>
                    
                    <!-- Top Flap -->
                    <div class="envelope-flap"></div>
                    
                    <!-- Gold Seal -->
                    <div class="${sealClass}">
                        <span class="seal-text">${luckySymbol}</span>
                    </div>
                    
                    <!-- Lucky Message -->
                    <div class="lucky-message">${luckyMessage}</div>
                    
                    <!-- Number Badge -->
                    <div class="envelope-number">L√¨ X√¨ #${number}</div>
                </div>
            `;

            // Th√™m l·ªõp m√†u cho envelope
            if (envelopeType) {
                envelope.classList.add(envelopeType);
            }



            envelope.addEventListener("click", function () {
                // H·ªßy timeout tr∆∞·ªõc ƒë√≥ n·∫øu c√≥
                if (globalClickTimeout) {
                    clearTimeout(globalClickTimeout);
                }
                
                // X√≥a hi·ªáu ·ª©ng clicked c·ªßa envelope tr∆∞·ªõc ƒë√≥
                if (lastClickedEnvelope && lastClickedEnvelope !== this) {
                    lastClickedEnvelope.classList.remove("clicked");
                }
                
                // Th√™m hi·ªáu ·ª©ng clicked cho envelope hi·ªán t·∫°i
                this.classList.add("clicked");
                lastClickedEnvelope = this;
                
                // L∆∞u reference
                const currentEnvelope = this;
                const currentNumber = number;
                
                // ƒê·∫∑t timeout m·ªõi
                globalClickTimeout = setTimeout(() => {
                    currentEnvelope.classList.remove("clicked");
                    
                    // Ch·ªâ hi·ªán confirm cho l·∫ßn click cu·ªëi c√πng
                    // if (confirm("B·∫°n ƒë√£ ch·∫Øc ch·∫Øn mu·ªën nh·∫≠n bao l√¨ x√¨ #" + currentNumber + " n√†y ch·ª©?")) {
                        console.log("ƒê√£ ch·ªçn l√¨ x√¨ #" + currentNumber);
                        
                        // M·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n
                        openHeartLetterModal(currentNumber);
                    // }
                    
                    globalClickTimeout = null;
                    lastClickedEnvelope = null;
                }, 500);
            });

            return envelope;
        }
        // =========== END PH·∫¶N T·∫†O BAO L√å X√å M·ªöI ===========

        // H√†m m·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n
        function openHeartLetterModal(envelopeNumber) {

            const cover = document.getElementById('card-cover');
            cover.style.display = 'flex';
            cover.style.opacity = '1';

            const modal = document.getElementById('heart-letter-modal');
            
            // Hi·ªÉn th·ªã modal
            modal.classList.remove('hidden');
            
            // Kh·ªüi t·∫°o canvas c√†o l√¨ x√¨
            initScratchCard();
        }

        // H√†m kh·ªüi t·∫°o canvas c√†o l√¨ x√¨
        function initScratchCard() {
            const canvas = document.getElementById('scratch-canvas');
            if (!canvas) return; // Th√™m ki·ªÉm tra
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const scratchArea = document.getElementById('scratch-area');
            const moneyDisplay = document.getElementById('money-display');
            
            // Random m·ªánh gi√°
            const amounts = [10000, 20000, 30000, 40000, 50000];
            const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
            moneyDisplay.textContent = `üéâ ${formatVND(randomAmount)} üéâ`;
            
            // Thi·∫øt l·∫≠p k√≠ch th∆∞·ªõc canvas
            canvas.width = scratchArea.offsetWidth;
            canvas.height = scratchArea.offsetHeight;
            
            // V·∫Ω l·ªõp ph·ªß v√†ng
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, '#DAA520');
            gradient.addColorStop(0.5, '#FFD700');
            gradient.addColorStop(1, '#DAA520');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Th√™m text "C√ÄO ƒê·ªÇ XEM L·ªòC XU√ÇN"
            ctx.fillStyle = '#8B0000';
            ctx.font = 'bold 14px "Be Vietnam Pro", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('C√ÄO ƒê·ªÇ XEM L·ªòC XU√ÇN', canvas.width / 2, canvas.height / 2);
            
            let isScratching = false;
            let lastX = 0;
            let lastY = 0;
            
            // H√†m c√†o
            function scratch(x, y) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // V·∫Ω ƒë∆∞·ªùng n·ªëi gi·ªØa c√°c ƒëi·ªÉm
                if (lastX && lastY) {
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(x, y);
                    ctx.lineWidth = 40;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }
                
                lastX = x;
                lastY = y;

            }
        
            // L·∫•y v·ªã tr√≠ chu·ªôt/touch
            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                return { x, y };
            }
            
            // S·ª± ki·ªán chu·ªôt
            canvas.addEventListener('mousedown', (e) => {
                isScratching = true;
                const pos = getPosition(e);
                scratch(pos.x, pos.y);
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (isScratching) {
                    const pos = getPosition(e);
                    scratch(pos.x, pos.y);
                }
            });
            
            canvas.addEventListener('mouseup', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });
            
            canvas.addEventListener('mouseleave', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });
            
            // S·ª± ki·ªán touch (mobile)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isScratching = true;
                const pos = getPosition(e);
                scratch(pos.x, pos.y);
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (isScratching) {
                    const pos = getPosition(e);
                    scratch(pos.x, pos.y);
                }
            });
            
            canvas.addEventListener('touchend', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });

             // Force canvas l√™n tr√™n c√πng
            canvas.style.position = 'absolute';
            canvas.style.zIndex = '10';
            canvas.style.pointerEvents = 'auto';
            
        }

        // X·ª≠ l√Ω ƒë√≥ng modal - ƒê·∫∂T NGO√ÄI H√ÄM openHeartLetterModal
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('heart-letter-modal').classList.add('hidden');
        });

        // ===== M·ªû THI·ªÜP ‚Üí ·∫®N COVER =====
        document.getElementById('open-card-btn').addEventListener('click', function () {
            const cover = document.getElementById('card-cover');

            cover.style.opacity = '0';
            cover.style.transition = 'opacity 0.6s ease';

            setTimeout(() => {
                cover.style.display = 'none';
            }, 600);
        });


        // ƒê√≥ng modal khi click overlay
        document.getElementById('heart-letter-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
        // end H√†m m·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n

        // =========== AUTO SHOW 24 ENVELOPES FOR TESTING ===========
        if (DEBUG_MODE) {
            window.addEventListener('DOMContentLoaded', function() {
                // ·∫®n ph·∫ßn ch·ªçn ng∆∞·ªùi nh·∫≠n
                document.querySelector(".grid.grid-cols-2").classList.add("hidden");
                document.getElementById("selection-display").classList.add("hidden");
                document.getElementById("continue-btn").classList.add("hidden");
                
                // Hi·ªÉn th·ªã container 24 bao l√¨ x√¨
                const envelopesContainer = document.getElementById("envelopes-container");
                envelopesContainer.classList.remove("hidden");
                
                // T·∫°o 24 bao l√¨ x√¨
                const envelopesGrid = document.getElementById("envelopes-grid");
                envelopesGrid.innerHTML = "";
                
                for (let i = 1; i <= 24; i++) {
                    envelopesGrid.appendChild(createEnvelope(i));
                }
                
                // Set selectedRecipient ƒë·ªÉ n√∫t Back v·∫´n ho·∫°t ƒë·ªông
                selectedRecipient = "test-mode";
            });
        }
        // =========== END AUTO SHOW ===========


        // Element SDK initialization
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById("tagline").textContent =
                        config.tagline || defaultConfig.tagline;
                    document.getElementById("main-heading").textContent =
                        config.main_heading || defaultConfig.main_heading;
                    document.getElementById("footer-text").textContent =
                        config.footer_text || defaultConfig.footer_text;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () =>
                                config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            },
                        },
                        {
                            get: () => config.card_color || defaultConfig.card_color,
                            set: (value) => {
                                config.card_color = value;
                                window.elementSdk.setConfig({ card_color: value });
                            },
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            },
                        },
                        {
                            get: () => config.gold_color || defaultConfig.gold_color,
                            set: (value) => {
                                config.gold_color = value;
                                window.elementSdk.setConfig({ gold_color: value });
                            },
                        },
                        {
                            get: () => config.accent_color || defaultConfig.accent_color,
                            set: (value) => {
                                config.accent_color = value;
                                window.elementSdk.setConfig({ accent_color: value });
                            },
                        },
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined,
                }),
                mapToEditPanelValues: (config) =>
                    new Map([
                        ["tagline", config.tagline || defaultConfig.tagline],
                        [
                            "main_heading",
                            config.main_heading || defaultConfig.main_heading,
                        ],
                        ["footer_text", config.footer_text || defaultConfig.footer_text],
                    ]),
            });
        }
    </script>

    <!-- Setting m·ªánh gi√° l√¨ x√¨ -->
    <script>
                // ===== X·ª¨ L√ù MODAL C√ÄI ƒê·∫∂T =====
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const saveSettings = document.getElementById('save-settings');
        const resetSettings = document.getElementById('reset-settings');

        // ===== Form =====
        // ===== GENERATE FORM C√ÄI ƒê·∫∂T =====
        function generateSettingsForm() {
            const container = document.getElementById('settings-form-container');
            container.innerHTML = ''; // X√≥a n·ªôi dung c≈©
            
            // L·∫•y c√†i ƒë·∫∑t t·ª´ localStorage (ho·∫∑c d√πng m·∫∑c ƒë·ªãnh)
            const savedSettings = JSON.parse(localStorage.getItem('envelopeSettings') || '{}');
            
            // Loop qua t·∫•t c·∫£ ng∆∞·ªùi nh·∫≠n
            Object.keys(recipientNames).forEach(key => {
                const name = recipientNames[key];
                const icon = recipientIcons[key];
                
                // L·∫•y gi√° tr·ªã ƒë√£ l∆∞u ho·∫∑c d√πng m·∫∑c ƒë·ªãnh
                const settings = savedSettings[key] || { min: 10000, max: 50000, specialCount: 1  };
                
                // T√≠nh to√°n c√°c gi√° tr·ªã ban ƒë·∫ßu
                const initialSpecialAmount = settings.specialAmount || 100000 || settings.max; // M·∫∑c ƒë·ªãnh = max
                const initialSpecialCount = settings.specialCount || 1;

                let initialPreviewText = '';
                if (initialSpecialCount === 0) {
                    initialPreviewText = `0 bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(initialSpecialAmount)}`;
                } else if (initialSpecialCount === 1) {
                    initialPreviewText = `1 bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(initialSpecialAmount)} üéâ`;
                } else {
                    initialPreviewText = `${initialSpecialCount} bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(initialSpecialAmount)} üéâ`;
                }

                const initialNormalCount = 24 - initialSpecialCount;
                let initialSpecialListHTML = '';
                if (initialSpecialCount > 0) {
                    initialSpecialListHTML = `<div>‚Ä¢ <span class="font-semibold text-yellow-600">${initialSpecialCount} bao ƒê·∫∂C BI·ªÜT</span>: ${formatVND(initialSpecialAmount)} üåü</div>`;
                }

                // T·∫°o card
                const card = document.createElement('div');
                card.className = 'setting-card bg-white rounded-lg p-4 shadow-md border-2 border-tet-gold/30 hover:border-tet-gold transition';
                card.dataset.recipient = key;
                card.innerHTML = `
                    <div class="flex items-center gap-3 mb-3">
                        <span class="text-3xl">${icon}</span>
                        <h3 class="font-heading text-xl font-bold text-tet-red">${name}</h3>
                        <span class="toggle-advanced text-end cursor-pointer ml-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 640 640">
                                <path fill="#74c0fc" d="M96 128C78.3 128 64 142.3 64 160C64 177.7 78.3 192 96 192L182.7 192C195 220.3 223.2 240 256 240C288.8 240 317 220.3 329.3 192L544 192C561.7 192 576 177.7 576 160C576 142.3 561.7 128 544 128L329.3 128C317 99.7 288.8 80 256 80C223.2 80 195 99.7 182.7 128L96 128zM96 288C78.3 288 64 302.3 64 320C64 337.7 78.3 352 96 352L342.7 352C355 380.3 383.2 400 416 400C448.8 400 477 380.3 489.3 352L544 352C561.7 352 576 337.7 576 320C576 302.3 561.7 288 544 288L489.3 288C477 259.7 448.8 240 416 240C383.2 240 355 259.7 342.7 288L96 288zM96 448C78.3 448 64 462.3 64 480C64 497.7 78.3 512 96 512L150.7 512C163 540.3 191.2 560 224 560C256.8 560 285 540.3 297.3 512L544 512C561.7 512 576 497.7 576 480C576 462.3 561.7 448 544 448L297.3 448C285 419.7 256.8 400 224 400C191.2 400 163 419.7 150.7 448L96 448z"/>
                            </svg>
                        </span>
                    </div>
                    
                    <div class="space-y-3">
                        <!-- Min -->
                        <div>
                            <label class="text-sm text-gray-600 block mb-1">M·ªánh gi√° t·ªëi thi·ªÉu (VND)</label>
                            <input type="text" 
                                class="setting-input-min w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tet-gold focus:outline-none"
                                data-recipient="${key}" 
                                data-field="min"
                                value="${formatNumberInput(settings.min.toString())}"
                                inputmode="numeric"
                                placeholder="10.000">
                        </div>
                        
                        <!-- Max -->
                        <div>
                            <label class="text-sm text-gray-600 block mb-1">M·ªánh gi√° t·ªëi ƒëa (VND)</label>
                            <input type="text" 
                                class="setting-input-max w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tet-gold focus:outline-none"
                                data-recipient="${key}" 
                                data-field="max"
                                value="${formatNumberInput(settings.max.toString())}"
                                inputmode="numeric"
                                placeholder="100.000">
                        </div>
                        
                        <!-- Special Amount (M·ªöI) -->
                        <div>
                            <label class="text-sm text-gray-600 block mb-1">
                                M·ªánh gi√° ƒë·∫∑c bi·ªát (VND)
                                <span class="text-xs text-yellow-600">‚ú® May m·∫Øn</span>
                            </label>
                            
                            <!-- √Åp d·ª•ng m·ªánh gi√° ƒë·∫∑c bi·ªát n√†y cho t·∫•t c·∫£  -->
                            <label class="form-check-label text-sm mb-1">
                                <input type="checkbox" class="form-check-input text-sm" name="" id="" value="checkedValue" checked> √Åp d·ª•ng cho t·∫•t c·∫£ 
                            </label>

                            <input type="text" 
                                class="setting-input-special-amount w-full px-3 py-2 border-2 border-yellow-300 bg-yellow-50 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:outline-none"
                                data-recipient="${key}" 
                                data-field="special-amount"
                                value="${formatNumberInput(initialSpecialAmount.toString())}"
                                inputmode="numeric"
                                placeholder="200.000">
                                
                        </div>
                        
                        <!-- Preview -->
                        <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded">
                            üí° Random t·ª´: <strong class="preview-min">${formatVND(settings.min)}</strong> ‚Üí <strong class="preview-max">${formatVND(settings.max)}</strong>
                        </div>
                        
                        <!-- Advanced Options -->
                        <div class="advanced-options hidden mt-3 pt-3 border-t border-gray-200">
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">‚öôÔ∏è T√πy ch·ªânh n√¢ng cao</h4>
                            
                            <!-- √Åp d·ª•ng t√πy chirng n√¢ng cao n√†y cho t·∫•t c·∫£  -->
                            <label class="form-check-label text-sm mb-2">
                                <input type="checkbox" class="form-check-input text-sm" name="" id="" value="checkedValue" checked> √Åp d·ª•ng cho t·∫•t c·∫£ 
                            </label>

                            <!-- S·ªë l∆∞·ª£ng bao ƒë·∫∑c bi·ªát -->
                            <div class="bg-blue-50 p-3 rounded-lg space-y-2">
                                <div class="flex items-center justify-between">
                                    <label class="text-xs text-gray-600">
                                        S·ªë l∆∞·ª£ng bao c√≥ m·ªánh gi√° <strong class="special-amount-display">${formatVND(initialSpecialAmount)}</strong>
                                    </label>
                                    <div class="flex items-center gap-2">
                                        <button class="decrease-special bg-gray-300 hover:bg-gray-400 w-6 h-6 rounded text-sm font-bold">-</button>
                                        <input type="number" 
                                            data-recipient="${key}"
                                            data-field="special-count"
                                            value="${initialSpecialCount}"
                                            min="0"
                                            max="24"
                                            class="special-count-input w-12 text-center border border-gray-300 rounded py-1 text-sm">
                                        <button class="increase-special bg-gray-300 hover:bg-gray-400 w-6 h-6 rounded text-sm font-bold">+</button>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500 italic">
                                    <span class="special-preview">${initialPreviewText}</span>
                                </div>
                            </div>
                            
                            <!-- Th√™m m·ªánh gi√° ƒë·∫∑c bi·ªát kh√°c -->
                            <div class="mt-3">
                                <button class="add-custom-special w-full bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white text-xs font-semibold py-2 px-3 rounded-lg transition flex items-center justify-center gap-2">
                                    <span>‚ú®</span>
                                    <span>Th√™m m·ªánh gi√° ƒë·∫∑c bi·ªát kh√°c</span>
                                </button>
                            </div>
                            
                            <!-- Container cho c√°c m·ªánh gi√° ƒë·∫∑c bi·ªát t√πy ch·ªânh -->
                            <div class="custom-specials-container mt-2 space-y-2">
                                <!-- S·∫Ω th√™m sau -->
                            </div>
                            
                            <!-- T·ªïng k·∫øt -->
                            <div class="mt-3 p-2 bg-green-50 rounded border border-green-200">
                                <div class="text-xs text-green-700">
                                    <div class="font-semibold mb-1">üìä Ph√¢n b·ªë 24 bao l√¨ x√¨:</div>
                                    <div class="pl-3 space-y-1">
                                        <div>‚Ä¢ <span class="normal-count-preview">${initialNormalCount} bao</span> th∆∞·ªùng: <span class="preview-min">${formatVND(settings.min)}</span> - <span class="preview-max">${formatVND(settings.max)}</span></div>
                                        <div class="special-count-preview-list">
                                            ${initialSpecialListHTML}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                
                container.appendChild(card);
            });
        
            // Real-time update preview khi nh·∫≠p
            container.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', function(e) {
                    // L∆∞u v·ªã tr√≠ con tr·ªè
                    const cursorPosition = this.selectionStart;
                    const oldLength = this.value.length;
                    
                    // Format input
                    const rawValue = this.value;
                    const formattedValue = formatNumberInput(rawValue);
                    this.value = formattedValue;
                    
                    // ƒêi·ªÅu ch·ªânh l·∫°i v·ªã tr√≠ con tr·ªè sau khi format
                    const newLength = formattedValue.length;
                    const lengthDiff = newLength - oldLength;
                    this.selectionStart = this.selectionEnd = cursorPosition + lengthDiff;
                    
                    // Update preview
                    const card = this.closest('.setting-card');
                    const minInput = card.querySelector('[data-field="min"]');
                    const maxInput = card.querySelector('[data-field="max"]');
                    const previewMin = card.querySelector('.preview-min');
                    const previewMax = card.querySelector('.preview-max');
                    
                    const minValue = parseNumberInput(minInput.value);
                    const maxValue = parseNumberInput(maxInput.value);
                    
                    // Format preview
                    previewMin.textContent = formatVND(minValue);
                    previewMax.textContent = formatVND(maxValue);
                    
                    // Highlight n·∫øu min >= max (l·ªói)
                    // Auto-adjust: N·∫øu min >= max th√¨ t·ª± ƒë·ªông tƒÉng max
                    // Gi·ªõi h·∫°n Min t·ªëi ƒëa 100 tri·ªáu
                    const MAX_MIN_VALUE = 100000000;
                    // Gi·ªõi h·∫°n Max t·ªëi ƒëa 200 tri·ªáu
                    const MAX_MAX_VALUE = 200000000;

                    // Ki·ªÉm tra v√† gi·ªõi h·∫°n Min
                    let finalMinValue = minValue;
                    if (this.dataset.field === 'min' && minValue > MAX_MIN_VALUE) {
                        finalMinValue = MAX_MIN_VALUE;
                        minInput.value = formatNumberInput(MAX_MIN_VALUE.toString());
                        previewMin.textContent = formatVND(MAX_MIN_VALUE);
                        
                        // Flash effect
                        minInput.classList.add('bg-yellow-100');
                        setTimeout(() => minInput.classList.remove('bg-yellow-100'), 500);
                    }

                    // Ki·ªÉm tra v√† gi·ªõi h·∫°n Max
                    let finalMaxValue = maxValue;
                    if (this.dataset.field === 'max' && maxValue > MAX_MAX_VALUE) {
                        finalMaxValue = MAX_MAX_VALUE;
                        maxInput.value = formatNumberInput(MAX_MAX_VALUE.toString());
                        previewMax.textContent = formatVND(MAX_MAX_VALUE);
                        
                        // Flash effect
                        maxInput.classList.add('bg-yellow-100');
                        setTimeout(() => maxInput.classList.remove('bg-yellow-100'), 500);
                    }

                    // Auto-adjust: N·∫øu min >= max th√¨ t·ª± ƒë·ªông tƒÉng max
                    if (finalMinValue >= finalMaxValue && finalMinValue > 0 && finalMaxValue > 0) {
                        const newMaxValue = Math.min(finalMinValue + 10000, MAX_MAX_VALUE);
                        maxInput.value = formatNumberInput(newMaxValue.toString());
                        previewMax.textContent = formatVND(newMaxValue);
                        
                        // B·ªè highlight ƒë·ªè v√¨ ƒë√£ t·ª± s·ª≠a
                        previewMin.classList.remove('text-red-600');
                        previewMax.classList.remove('text-red-600');
                        
                        // Th√™m hi·ªáu ·ª©ng flash ƒë·ªÉ user bi·∫øt ƒë√£ t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh
                        maxInput.classList.add('bg-yellow-100');
                        setTimeout(() => {
                            maxInput.classList.remove('bg-yellow-100');
                        }, 500);
                    } else {
                        previewMin.classList.remove('text-red-600');
                        previewMax.classList.remove('text-red-600');
                    }
                });
            });
        
            
        
        }
        // ===== end Form =====


        // G·ªçi h√†m khi m·ªü modal
        settingsBtn.addEventListener('click', function() {
            generateSettingsForm(); // Generate form tr∆∞·ªõc
            settingsModal.classList.remove('hidden');
        });

        // ===== EVENT DELEGATION (ch·ªâ g·∫Øn 1 l·∫ßn) =====
        let isEventDelegationSetup = false;

        if (!isEventDelegationSetup) {
            const container = document.getElementById('settings-form-container');
            
            // X·ª≠ l√Ω t·∫•t c·∫£ click trong container
            container.addEventListener('click', function(e) {
                 // Toggle advanced options
                if (e.target.closest('.toggle-advanced')) {
                    const toggleBtn = e.target.closest('.toggle-advanced');
                    const card = toggleBtn.closest('.setting-card');
                    const advancedOptions = card.querySelector('.advanced-options');
                    const svg = toggleBtn.querySelector('svg');
                    
                    if (advancedOptions.classList.contains('hidden')) {
                        advancedOptions.classList.remove('hidden');
                        svg.style.transform = 'rotate(180deg)';
                        svg.style.transition = 'transform 0.3s ease';
                    } else {
                        advancedOptions.classList.add('hidden');
                        svg.style.transform = 'rotate(0deg)';
                    }
                    return; // D·ª´ng x·ª≠ l√Ω c√°c event kh√°c
                }

                // N√∫t gi·∫£m
                if (e.target.closest('.decrease-special')) {
                    const btn = e.target.closest('.decrease-special');
                    const input = btn.parentElement.querySelector('.special-count-input');
                    const currentValue = parseInt(input.value) || 0;
                    if (currentValue > 0) {
                        input.value = currentValue - 1;
                        updateSpecialPreview(btn.closest('.setting-card'));
                    }
                }
                
                // N√∫t tƒÉng
                if (e.target.closest('.increase-special')) {
                    const btn = e.target.closest('.increase-special');
                    const input = btn.parentElement.querySelector('.special-count-input');
                    const currentValue = parseInt(input.value) || 0;
                    if (currentValue < 24) {
                        input.value = currentValue + 1;
                        updateSpecialPreview(btn.closest('.setting-card'));
                    }
                }
            });
            
            // X·ª≠ l√Ω input
            container.addEventListener('input', function(e) {
                if (e.target.classList.contains('special-count-input')) {
                    let value = parseInt(e.target.value) || 0;
                    if (value < 0) value = 0;
                    if (value > 24) value = 24;
                    e.target.value = value;
                    updateSpecialPreview(e.target.closest('.setting-card'));
                }
                
                // M·ªöI: X·ª≠ l√Ω khi thay ƒë·ªïi special amount
                if (e.target.classList.contains('setting-input-special-amount')) {
                    const card = e.target.closest('.setting-card');
                    
                    // L∆∞u v·ªã tr√≠ con tr·ªè
                    const cursorPosition = e.target.selectionStart;
                    const oldLength = e.target.value.length;
                    
                    // Format input
                    const rawValue = e.target.value;
                    const formattedValue = formatNumberInput(rawValue);
                    e.target.value = formattedValue;
                    
                    // ƒêi·ªÅu ch·ªânh l·∫°i v·ªã tr√≠ con tr·ªè
                    const newLength = formattedValue.length;
                    const lengthDiff = newLength - oldLength;
                    e.target.selectionStart = e.target.selectionEnd = cursorPosition + lengthDiff;
                    
                    // Update preview
                    updateSpecialPreview(card);
                }
            });
            
            isEventDelegationSetup = true;
        }

        // H√†m c·∫≠p nh·∫≠t preview (di chuy·ªÉn ra ngo√†i ƒë·ªÉ d√πng chung)
        function updateSpecialPreview(card) {
            const specialCount = parseInt(card.querySelector('.special-count-input').value) || 0;
            const specialAmount = parseNumberInput(card.querySelector('[data-field="special-amount"]').value);
            const maxValue = parseNumberInput(card.querySelector('[data-field="max"]').value);
            
            const preview = card.querySelector('.special-preview');
            const specialAmountDisplay = card.querySelector('.special-amount-display');
            
            // Update display c·ªßa special amount
            if (specialAmountDisplay) {
                specialAmountDisplay.textContent = formatVND(specialAmount);
            }
            
            // Update preview text
            if (specialCount === 0) {
                preview.textContent = `0 bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(specialAmount)}`;
            } else if (specialCount === 1) {
                preview.textContent = `1 bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(specialAmount)} üéâ`;
            } else {
                preview.textContent = `${specialCount} bao s·∫Ω c√≥ m·ªánh gi√° ${formatVND(specialAmount)} üéâ`;
            }
            
            // C·∫≠p nh·∫≠t ph√¢n b·ªë t·ªïng qu√°t
            const normalCount = 24 - specialCount;
            card.querySelector('.normal-count-preview').textContent = `${normalCount} bao`;
            
            const specialList = card.querySelector('.special-count-preview-list');
            if (specialCount > 0) {
                specialList.innerHTML = `<div>‚Ä¢ <span class="font-semibold text-yellow-600">${specialCount} bao ƒê·∫∂C BI·ªÜT</span>: ${formatVND(specialAmount)} üåü</div>`;
            } else {
                specialList.innerHTML = '';
            }
        }
        // ================================================


        // ƒê√≥ng modal
        closeSettings.addEventListener('click', function() {
            settingsModal.classList.add('hidden');
        });

        // ƒê√≥ng khi click overlay
        settingsModal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // L∆∞u c√†i ƒë·∫∑t
        saveSettings.addEventListener('click', function() {
            const settings = {};
            
            // L·∫•y t·∫•t c·∫£ input trong form
            document.querySelectorAll('#settings-form-container input').forEach(input => {
                const recipient = input.dataset.recipient;
                const field = input.dataset.field;
                
                let value;
                if (field === 'special-count') {
                    // V·ªõi special-count, l·∫•y gi√° tr·ªã s·ªë nguy√™n
                    value = parseInt(input.value) || 0;
                } else {
                    // V·ªõi min/max, parse t·ª´ format "10.000" v·ªÅ 10000
                    value = parseNumberInput(input.value);
                }
                
                if (!settings[recipient]) {
                    settings[recipient] = {};
                }
                
                // L∆∞u theo t√™n field ph√π h·ª£p
                if (field === 'min') {
                    settings[recipient].min = value;
                } else if (field === 'max') {
                    settings[recipient].max = value;
                } else if (field === 'special-amount') {
                    settings[recipient].specialAmount = value;
                } else if (field === 'special-count') {
                    settings[recipient].specialCount = value;
                }

            });
            
            // Validate: min ph·∫£i < max
            let hasError = false;
            Object.keys(settings).forEach(key => {
                if (settings[key].min >= settings[key].max) {
                    alert(`‚ùå ${recipientNames[key]}: M·ªánh gi√° t·ªëi thi·ªÉu ph·∫£i nh·ªè h∆°n t·ªëi ƒëa!`);
                    hasError = true;
                }
            });
            
            if (hasError) return;
            
            // L∆∞u v√†o localStorage
            localStorage.setItem('envelopeSettings', JSON.stringify(settings));
            
            alert('‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng!');
            settingsModal.classList.add('hidden');
        });

        // Reset m·∫∑c ƒë·ªãnh
        resetSettings.addEventListener('click', function() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën reset t·∫•t c·∫£ v·ªÅ m·∫∑c ƒë·ªãnh (10-50k)?')) {
                localStorage.removeItem('envelopeSettings');
                generateSettingsForm(); // Reload form v·ªõi gi√° tr·ªã m·∫∑c ƒë·ªãnh
                alert('üîÑ ƒê√£ reset v·ªÅ m·∫∑c ƒë·ªãnh!');
            }
        });
        // ===== END X·ª¨ L√ù MODAL C√ÄI ƒê·∫∂T =====
    </script>
    <!-- End Setting m·ªánh gi√° l√¨ x√¨ -->

</body>

</html>