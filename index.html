<!doctype html>
<html lang="vi" class="h-full">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L·ªôc Xu√¢n - G·ª≠i Trao Y√™u Th∆∞∆°ng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&amp;family=Be+Vietnam+Pro:wght@300;400;500;600&amp;display=swap"
        rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@600;700;900&display=swap"
        rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link href="src/css/style.css" rel="stylesheet" />
    <link href="src/css/phao-hoa.css" rel="stylesheet" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "tet-red": "#8B0000",
                        "tet-red-light": "#B22222",
                        "tet-gold": "#FFD700",
                        "tet-gold-dark": "#DAA520",
                        "tet-cream": "#FFF8DC",
                    },
                    fontFamily: {
                        heading: ["Playfair Display", "serif"],
                        body: ["Be Vietnam Pro", "sans-serif"],
                    },
                },
            },
        };
    </script>
    <style>
        /* Th√™m v√†o ph·∫ßn <head> */
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        
        /* Animation cho scratch overlay */
        .scratched {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        
        /* Animation cho money reveal */
        .money-reveal {
            animation: moneyPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes moneyPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* CSS cho COVER M·ªöI */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.4); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes lantern-sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .outer-card-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 215, 0, 0.3);
        }

        .inner-card-frame {
            border: 2px solid;
            border-image: linear-gradient(135deg, #ffd700, #b8860b, #ffd700, #daa520, #ffd700) 1;
            background: linear-gradient(180deg, rgba(139, 0, 0, 0.95) 0%, rgba(80, 0, 0, 0.98) 100%);
        }

        .text-shadow-gold {
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .text-shadow-dark {
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .float-animation { animation: float 4s ease-in-out infinite; }
        .sparkle { animation: sparkle 2s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

        .shimmer-text {
            background: linear-gradient(90deg, #ffd700, #fff8dc, #ffd700, #fff8dc, #ffd700);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
        }

        .lantern {
            animation: lantern-sway 3s ease-in-out infinite;
            transform-origin: top center;
        }

        /* .lantern-delay-1 { animation-delay: 0.3s; } */

        .decorative-corner {
            position: absolute;
            width: 80px;
            height: 80px;
            opacity: 0.8;
        }

        .corner-tl { top: 10px; left: 10px; }
        .corner-tr { top: 10px; right: 10px; transform: scaleX(-1); }
        .corner-bl { bottom: 10px; left: 10px; transform: scaleY(-1); }
        .corner-br { bottom: 10px; right: 10px; transform: scale(-1, -1); }

        .img-fallback {
            background: linear-gradient(135deg, #8B0000, #FFD700);
        }
    </style>

    <style>
        /* Canvas c√†o l√¨ x√¨ */
        #scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
            border-radius: 0.5rem;
        }

        #scratch-canvas:active {
            cursor: grabbing;
        }

        #scratch-area {
            position: relative;
            user-select: none;
            -webkit-user-select: none;
        }
    </style>

    <style>
        input.bg-yellow-100 {
            transition: background-color 0.5s ease;
        }
    </style>

    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }
    </style>

    <!-- /* Animation x√°o tr·ªôn l√¨ x√¨ */ -->
    <style>
        /* Animation x√°o tr·ªôn - THU V√ÄO GI·ªÆA ‚Üí PH√ìNG RA (NO ROTATE) */
        @keyframes shuffle-to-center {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            45% {
                transform: translate(var(--center-x), var(--center-y)) scale(0.1);
                opacity: 0.3;
            }
            55% {
                transform: translate(var(--center-x), var(--center-y)) scale(0.1);
                opacity: 0.3;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
        }

        .envelope-item {
            position: relative;
            transition: transform 0.3s ease;
        }

        .shuffling-center {
            animation: shuffle-to-center 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            will-change: transform, opacity;
        }

        /* V√≤ng xoay ·ªü gi·ªØa */
        @keyframes center-pulse {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        .shuffle-vortex {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            margin: -40px 0 0 -40px;
            border: 5px solid #FFD700;
            border-radius: 50%;
            animation: center-pulse 0.8s ease-in-out;
            z-index: 99;
            pointer-events: none;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }

        .shuffling-center {
            animation: shuffle-to-center 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            will-change: transform, opacity;
            -webkit-transform: translateZ(0); /* Force GPU */
            transform: translateZ(0);
        }

    </style>
    <!-- /* END Animation x√°o tr·ªôn l√¨ x√¨ */ -->

    <style>
        @keyframes slideInLeft {
            from {
                transform: translateX(-100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .animate-slideInLeft {
            animation: slideInLeft 0.5s ease-out;
        }

        /* Hide name form initially if name exists */
        #name-form-wrapper.hidden {
            display: none;
        }

        #sender-badge {
            transition: all 0.3s ease;
        }

        #sender-badge:hover {
            filter: brightness(1.1);
        }

        /* Dot indicator animation */
        @keyframes pulse-dot {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        #sender-badge .animate-pulse {
            animation: pulse-dot 2s ease-in-out infinite;
        }
    </style>


    <!-- /* N√∫t X ƒë√≥ng v·ªè thi·ªáp */ -->
    <style>
        /* N√∫t X ƒë√≥ng v·ªè thi·ªáp */
        #close-card-cover-btn {
            backdrop-filter: blur(4px);
        }

        #close-card-cover-btn:hover {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        #close-card-cover-btn svg {
            transition: transform 0.3s ease;
        }

        #close-card-cover-btn:hover svg {
            transform: rotate(90deg);
        }
    </style>
</head>

<body class="h-full font-body">
    <div id="app-wrapper" class="h-full w-full overflow-auto bg-pattern relative">
        <!-- Decorative Elements -->
        <div class="absolute top-4 left-4 text-4xl lantern opacity-80">üèÆ</div>
        <div class="absolute top-4 right-4 text-4xl lantern opacity-80" style="animation-delay: -2s">
            üèÆ
        </div>
        <div id="settings-btn" class="absolute top-6 right-20 text-4xl lantern opacity-80 cursor-pointer z-20" style="animation-delay: -2s">
            <svg xmlns="http://www.w3.org/2000/svg" height="30" width="30" viewBox="0 0 640 640">
                <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
                <path fill="#ffffff" d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z"/></svg>    
        </div>
        <div class="absolute top-20 left-1/4 text-2xl floating opacity-60">
            üå∏
        </div>
        <div class="absolute top-32 right-1/4 text-xl floating opacity-50" style="animation-delay: -1s">
            ‚ú®
        </div>
        <div class="absolute bottom-20 left-16 text-3xl floating opacity-70" style="animation-delay: -3s">
            üéã
        </div>
        <div class="absolute bottom-32 right-20 text-2xl floating opacity-60" style="animation-delay: -2s">
            üå∫
        </div>
        <!-- Sparkle decorations -->
        <div class="absolute top-1/4 left-10 w-2 h-2 bg-tet-gold rounded-full sparkle"></div>
        <div class="absolute top-1/3 right-16 w-1.5 h-1.5 bg-tet-gold rounded-full sparkle"
            style="animation-delay: -0.5s"></div>
        <div class="absolute bottom-1/4 left-20 w-2 h-2 bg-tet-gold rounded-full sparkle" style="animation-delay: -1s">
        </div>

        <!-- N√∫t hi·ªÉn th·ªã t√™n ng∆∞·ªùi g·ª≠i (sau khi nh·∫≠p) top-6 left-6 -->
        <div id="sender-badge" class="hidden fixed bottom-6 right-6 z-30 cursor-pointer group">
            <div class="bg-gradient-to-r from-amber-500 to-amber-600 text-red-900 px-4 py-2 rounded-full shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 flex items-center gap-2">
                <span class="text-xl">‚úçÔ∏è</span>
                <span id="sender-badge-name" class="font-dancing font-bold text-base"></span>
                <span class="text-xs opacity-70 group-hover:opacity-100 transition">‚úèÔ∏è</span>
            </div>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white animate-pulse"></div>
        </div>

        <!-- Main Content -->
        <div class="min-h-full flex flex-col items-center justify-center px-2 sm:px-4 py-8 relative z-10">
            <!-- Header Section -->
            <div class="text-center mb-6">
                <!-- Tagline -->
                <p id="tagline" class="text-tet-cream/80 text-sm md:text-base tracking-widest mb-4 font-light">
                    G·ª≠i trao y√™u th∆∞∆°ng ‚Äì Nh·∫≠n l·ªôc an khang
                </p>
                <!-- Main Heading -->
                <h1 id="main-heading" class="font-heading text-2xl md:text-5xl lg:text-6xl font-bold gold-shimmer mb-2">
                    Ng∆∞·ªùi trao ƒëang g·ª≠i l·ªôc xu√¢n cho..?
                </h1>
                <!-- Decorative line -->
                <div class="flex items-center justify-center gap-3 mt-4">
                    <div class="w-16 md:w-24 h-px bg-gradient-to-r from-transparent via-tet-gold to-transparent"></div>
                    <span class="text-tet-gold text-xl">‚ùÄ</span>
                    <div class="w-16 md:w-24 h-px bg-gradient-to-r from-transparent via-tet-gold to-transparent"></div>
                </div>
            </div>

            <!-- Cards Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 max-w-5xl mx-auto mb-8 md:mb-12">
                <!-- Card 1: √îng B√† -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="ong-ba">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë¥üëµ
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        √îng B√†
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        K√≠nh ch√∫c s·ª©c kh·ªèe
                    </p>
                </button>

                <!-- Card 2: B·ªë M·∫π -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="bo-me">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë®‚Äçüë©‚Äçüëß
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        B·ªë M·∫π
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Bi·∫øt ∆°n d∆∞·ª°ng d·ª•c
                    </p>
                </button>

                <!-- Card 3: Anh Ch·ªã Em -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="anh-chi-em">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë´
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Anh Ch·ªã Em
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        ƒê·ªìng h√†nh b√™n nhau
                    </p>
                </button>

                <!-- Card 4: Con C√°i -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="con-cai">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üë∂
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Con C√°i
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Mong con kh√¥n l·ªõn
                    </p>
                </button>

                <!-- Card 5: B·∫°n B√® -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="ban-be">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        ü§ù
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        B·∫°n B√®
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Tri k·ª∑ ƒë·ªìng h√†nh
                    </p>
                </button>

                <!-- Card 6: ƒê·ªìng Nghi·ªáp -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="dong-nghiep">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üíº
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        ƒê·ªìng Nghi·ªáp
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Th√†nh c√¥ng chung
                    </p>
                </button>

                <!-- Card 7: Th·∫ßy C√¥ -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="thay-co">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üìö
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Th·∫ßy C√¥
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        ∆†n d·∫°y d·ªó s√¢u
                    </p>
                </button>

                <!-- Card 8: Ng∆∞·ªùi Th∆∞∆°ng -->
                <button class="card-envelope rounded-2xl p-4 md:p-6 text-center cursor-pointer group"
                    data-recipient="nguoi-thuong">
                    <div class="text-4xl md:text-5xl mb-3 group-hover:scale-110 transition-transform">
                        üíï
                    </div>
                    <h3 class="font-heading text-tet-gold font-semibold text-lg md:text-xl mb-1">
                        Ng∆∞·ªùi Th∆∞∆°ng
                    </h3>
                    <p class="text-tet-cream/70 text-xs md:text-sm font-light">
                        Y√™u th∆∞∆°ng tr·ªçn ƒë·ªùi
                    </p>
                </button>
            </div>

            <!-- Selected Recipient Display -->
            <div id="selection-display" class="hidden text-center mb-6 animate-pulse">
                <p class="text-tet-cream text-lg">
                    B·∫°n ƒëang g·ª≠i l·ªôc xu√¢n ƒë·∫øn:
                    <span id="selected-name" class="text-tet-gold font-semibold"></span>
                </p>
            </div>

            <!-- Continue Button -->
            <button id="continue-btn"
                class="hidden bg-gradient-to-r from-tet-gold-dark via-tet-gold to-tet-gold-dark text-tet-red font-semibold px-8 py-3 rounded-full text-lg shadow-lg hover:shadow-tet-gold/50 hover:scale-105 transition-all duration-300 mb-8">
                Chao g·ª≠i y√™u th∆∞∆°ng ‚ú®
            </button>

            <!-- Envelopes Grid (hidden by default) -->
            <div id="envelopes-container" class="hidden max-w-6xl mx-auto w-full px-2 sm:px-4 ">
                <div class="text-center mb-8">
                    <h2 class="font-heading text-xl md:text-3xl font-bold gold-shimmer mb-4" id="envelopes-title">
                        <span id="total-envelopes-count">60</span> Bao L√¨ X√¨ Y√™u Th∆∞∆°ng
                    </h2>
                    <p class="text-tet-cream/70 text-sm md:text-base">
                        Ch·ªçn m·ªôt bao l√¨ x√¨ ƒë·ªÉ g·ª≠i trao y√™u th∆∞∆°ng
                    </p>
                </div>

                <!-- <div id="envelopes-grid"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-5 mb-12">
                </div> -->

                <div id="envelopes-grid"
                    class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-3 sm:gap-4 md:gap-5 mb-12">
                    <!-- Envelopes will be generated here based on TOTAL_ENVELOPES -->
                </div>

                <!-- N√∫t X√°o Tr·ªôn & Show M·ªánh Gi√° -->
                <div class="text-center flex flex-wrap gap-4 justify-center">
                    <button id="reshuffle-envelopes" class="bg-gradient-to-r from-tet-gold to-tet-gold-dark text-tet-red font-bold px-8 py-3 rounded-full shadow-lg hover:shadow-tet-gold/50 hover:scale-105 transition-all">
                        üîÑ X√°o tr·ªôn
                    </button>
                    <button id="show-amounts-btn" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold px-8 py-3 rounded-full shadow-lg hover:shadow-blue-500/50 hover:scale-105 transition-all" title="Hi·ªÉn th·ªã m·ªánh gi√° ngo√†i bao l√¨ x√¨">
                        üí∞ Minh b·∫°ch
                    </button>
                </div>


                <div class="text-center mt-6 ">
                    <button id="back-btn"
                        class="bg-tet-red-light text-tet-cream font-medium px-6 py-2 rounded-full hover:bg-tet-red transition-all duration-300">
                        ‚Üê Quay l·∫°i ch·ªçn m·ª•c ng∆∞·ªùi nh·∫≠n
                    </button>
                </div>
            
            </div>

            <!-- Footer -->
            <footer class="text-center">

                <button id="launchBtn" title="B·∫Øn ph√°o hoa">üéÜ</button>
                <canvas id="fireworksCanvas"></canvas>

                <p id="footer-text" class="font-heading text-tet-gold text-xl md:text-2xl mb-2">
                    L·ªôc Xu√¢n 2026
                </p>
                <p class="text-tet-cream/60 text-xs md:text-sm font-light tracking-wide">
                    Trao g·ª≠i y√™u th∆∞∆°ng ‚Ä¢ ƒê√≥n nh·∫≠n an khang
                </p>
                <div class="flex items-center justify-center gap-2 mt-3 text-tet-gold/90">
                    <span>üßß</span>
                    <span class="text-xs">Ch√∫c M·ª´ng NƒÉm M·ªõi</span>
                    <span>üßß</span>
                </div>
            </footer>
        </div>


            <!-- Form Nh·∫≠p T√™n Ng∆∞·ªùi G·ª≠i -->
        <div id="name-form-wrapper" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
            <div id="name-expanded" class="relative bg-gradient-to-br from-red-800 to-amber-800 rounded-2xl overflow-hidden shadow-2xl border-3 border-amber-400 transform animate-slideInLeft max-w-md w-full">
                <div class="absolute top-0 right-0 w-24 h-24 bg-amber-400/20 rounded-full blur-2xl"></div>
                <div class="relative p-5">
                    <div class="flex items-start gap-3 mb-3">
                        <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-amber-400 to-amber-600 rounded-full shadow-lg flex items-center justify-center">
                            <span class="text-2xl">‚úçÔ∏è</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-amber-300 mb-1 font-heading">
                                Nh·∫≠p t√™n c·ªßa b·∫°n
                            </h3>
                            <p class="text-amber-200/80 text-xs leading-tight">
                                T√™n s·∫Ω xu·∫•t hi·ªán trong ch·ªØ k√Ω cu·ªëi th∆∞
                            </p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <input type="text" 
                                id="sender-name" 
                                placeholder="V√≠ d·ª•: ƒê√†m ƒê√¨nh ƒê√†o" 
                                class="w-full px-4 py-3 text-base bg-white/15 border-2 border-amber-400/40 rounded-xl text-white placeholder-amber-300/40 focus:outline-none focus:border-amber-300 focus:bg-white/25 transition-all font-dancing backdrop-blur-sm" 
                                autocomplete="off" 
                                maxlength="30">
                    </div>
                        <button id="confirm-name-btn" 
                                disabled 
                                class="w-full bg-gradient-to-r from-amber-400 to-amber-600 hover:from-amber-500 hover:to-amber-700 text-red-900 font-bold py-2.5 px-4 rounded-xl text-sm transition-all duration-300 transform hover:scale-[1.02] hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg">
                            ‚ú® B·∫Øt ƒë·∫ßu
                        </button>
                        <p class="text-amber-400/50 text-[10px] mt-2 text-center">
                            üîí Th√¥ng tin ch·ªâ d√πng cho ch·ªØ k√Ω
                        </p>
            </div>
        </div>
                
    </div>

    <!-- Modal T√¢m Th∆∞ & L·ªôc Xu√¢n -->
    <!-- Modal 1: V·ªè Thi·ªáp (Cover1) -->
    <div id="card-cover-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/70" id="card-cover-overlay"></div>
        <div class="relative z-10 max-w-4xl w-full">

            <!-- ‚ú® N√öT X ƒê√ìNG THI·ªÜP -->
            <button id="close-card-cover-btn" class="absolute top-2 right-2 sm:top-4 sm:right-4 z-20 w-8 h-8 sm:w-10 sm:h-10 bg-red-900/80 hover:bg-red-800 text-amber-300 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 hover:rotate-90 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div class="relative bg-gradient-to-b from-red-900/90 to-red-950/95 rounded-md p-1 shadow-2xl outer-card-shadow">
                <div class="relative rounded-2xl p-6 md:p-8 inner-card-frame">
                    <svg class="decorative-corner corner-tl" viewbox="0 0 80 80">
                        <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                        <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                        <circle cx="8" cy="8" r="3" fill="#FFD700" />
                        <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                    </svg>
                    <svg class="decorative-corner corner-tr" viewbox="0 0 80 80">
                        <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                        <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                        <circle cx="8" cy="8" r="3" fill="#FFD700" />
                        <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                    </svg>
                    <svg class="decorative-corner corner-bl" viewbox="0 0 80 80">
                        <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                        <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                        <circle cx="8" cy="8" r="3" fill="#FFD700" />
                        <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                    </svg>
                    <svg class="decorative-corner corner-br" viewbox="0 0 80 80">
                        <path d="M5 40 Q5 5 40 5" fill="none" stroke="#FFD700" stroke-width="2" />
                        <path d="M10 35 Q10 10 35 10" fill="none" stroke="#FFD700" stroke-width="1.5" opacity="0.7" />
                        <circle cx="8" cy="8" r="3" fill="#FFD700" />
                        <path d="M15 5 L15 25 M5 15 L25 15" stroke="#FFD700" stroke-width="1" opacity="0.5" />
                    </svg>

                    <div class="text-center relative z-10 py-4">
                        <div class="inline-block mb-4">
                            <div class="relative">
                                <div class="absolute inset-0 bg-gradient-to-r from-yellow-600 to-yellow-400 blur-lg opacity-50 rounded-full"></div>
                                <div class="relative bg-gradient-to-br from-yellow-500 via-yellow-400 to-yellow-600 text-red-900 font-bold text-lg px-6 py-2 rounded-full shadow-lg text-shadow-gold">
                                    üê¥ NƒÇM B√çNH NG·ªå 2026 üê¥
                                </div>
                            </div>
                        </div>

                        <h1 class="font-heading text-3xl md:text-4xl font-bold mb-3 shimmer-text leading-tight">
                            CH√öC M·ª™NG NƒÇM M·ªöI
                        </h1>

                        <div class="flex items-center justify-center gap-3 my-4">
                            <div class="h-px w-16 bg-gradient-to-r from-transparent to-yellow-500"></div>
                            <span class="text-yellow-400 text-2xl">‚ùß</span>
                            <div class="h-px w-16 bg-gradient-to-l from-transparent to-yellow-500"></div>
                        </div>

                        <p class="font-dancing text-2xl md:text-3xl text-yellow-200 mb-6 text-shadow-dark">
                            An Khang Th·ªãnh V∆∞·ª£ng
                        </p>

                        <p class="text-yellow-100/90 text-sm md:text-base mb-6 px-4 leading-relaxed">
                            K√≠nh ch√∫c qu√Ω v·ªã m·ªôt nƒÉm m·ªõi<br />
                            <span class="text-yellow-300 font-semibold">V·∫°n S·ª± Nh∆∞ √ù ‚Ä¢ T√†i L·ªôc ƒê·∫ßy Nh√†</span>
                        </p>

                        <button id="open-card-btn" class="relative group pulse-glow rounded-full overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative bg-gradient-to-r from-yellow-500 via-yellow-400 to-yellow-500 text-red-900 font-bold px-10 py-2 rounded-full transition-all duration-300 group-hover:scale-105 text-shadow-gold">
                                <span class="flex items-center gap-2">
                                    <span>‚úâÔ∏è</span> <span>M·ªû THI·ªÜP</span> <span>‚úâÔ∏è</span>
                                </span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Modal 2: N·ªôi dung T√¢m Th∆∞ -->
<div id="heart-letter-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/70"></div>
    <div class="relative bg-gradient-to-br from-red-50 to-amber-50 w-full max-w-4xl rounded-xl shadow-xl overflow-hidden border-2 border-tet-gold">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-tet-red to-tet-red-light py-4 px-6 text-center">
            <h2 class="font-heading text-3xl font-bold text-tet-gold">T√ÇM TH∆Ø & L·ªòC XU√ÇN</h2>
            <p class="text-tet-cream/90 text-sm mt-1">Xu√¢n ·∫§t T·ªµ 2025 - An Khang Th·ªãnh V∆∞·ª£ng</p>
        </div>
        
        <!-- Content -->
        <div class="p-6 md:p-8">
            <!-- L·ªùi ch√∫c -->
            <div class="text-center mb-3 border-b-2 pb-6 border-tet-gold/30">
                <h3 class="font-heading text-2xl font-bold text-tet-red mb-3">Ch√∫c M·ª´ng NƒÉm M·ªõi!</h3>
                <p class="text-gray-700 text-lg leading-relaxed">
                    Ch√∫c b·∫°n m·ªôt nƒÉm m·ªõi tr√†n ƒë·∫ßy s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† th√†nh c√¥ng. 
                    Mong r·∫±ng nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t s·∫Ω ƒë·∫øn v·ªõi b·∫°n v√† gia ƒë√¨nh.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ph·∫ßn c√†o l·ªôc xu√¢n -->
                <div>
                    <div class="rounded-lg p-2">
                        <p class="text-sm text-gray-600 italic mb-1">Ch√∫c m·ª´ng nƒÉm m·ªõi ·∫§t T·ªµ 2025</p>
                        <div id="scratch-area" class="bg-gradient-to-r from-gray-200 to-gray-300 h-16 rounded-lg relative overflow-hidden flex items-center justify-center">
                            <!-- N·ªôi dung b√™n d∆∞·ªõi - s·ªë ti·ªÅn -->
                            <div id="lucky-amount" class="absolute inset-0 flex items-center justify-center text-xl md:text-2xl font-bold text-tet-red">
                                <span id="money-display"></span>
                            </div>
                            <!-- Canvas c√†o -->
                            <canvas id="scratch-canvas"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Ng∆∞·ªùi g·ª≠i -->
                <div class="text-end">
                    <p class="text-sm text-gray-600 italic mb-1">Ng∆∞·ªùi g·ª≠i</p>
                    <p id="sender-name-display" class="font-dancing text-3xl font-bold text-tet-red mb-1">ƒê√†m ƒê√¨nh ƒê√†o</p>
                </div>
            </div>
            
            <!-- N√∫t ƒë√≥ng -->
            <div class="text-center mt-5">
                <button id="close-modal" class="bg-tet-red text-tet-cream font-semibold px-8 py-3 rounded-full hover:bg-tet-red-light transition-all duration-300">
                    Tr√¢n Tr·ªçng C·∫£m ∆†n
                </button>
            </div>
        </div>
    </div>
</div>


    <!-- Modal C√†i ƒê·∫∑t M·ªánh Gi√° -->
    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/70"></div>
        
        <!-- Form Content -->
        <div class="relative bg-gradient-to-br from-red-50 to-amber-50 w-full max-w-4xl max-h-[90vh] rounded-xl shadow-2xl overflow-hidden border-2 border-tet-gold">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-tet-red to-tet-red-light py-4 px-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="font-heading text-2xl md:text-3xl font-bold text-tet-gold">L·ªôc Xu√¢n ƒê·∫ßu NƒÉm</h2>
                        <p class="text-tet-cream/90 text-xs md:text-sm mt-1">T√πy ch·ªânh m·ªánh gi√° cho t·ª´ng ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi nh·∫≠n</p>
                    </div>
                    <button id="close-settings" class="text-tet-cream hover:text-tet-gold text-3xl leading-none">√ó</button>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="settings-form-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Form s·∫Ω ƒë∆∞·ª£c generate t·ª± ƒë·ªông b·∫±ng JavaScript -->
                </div>
            </div>
            
            <!-- Footer -->
            <div class="bg-gray-100 px-6 py-4 flex justify-between items-center border-t">
                <button id="reset-settings" class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition">
                    üîÑ Reset M·∫∑c ƒê·ªãnh
                </button>
                <button id="save-settings" class="bg-tet-red text-tet-cream font-semibold px-8 py-2 rounded-lg hover:bg-tet-red-light transition">
                    üíæ L∆∞u C√†i ƒê·∫∑t
                </button>
            </div>
        </div>
    </div>
    <script src="src/js/helper.js"></script>
    <script src="src/js/script.js"></script>
    <script src="src/js/setting.js"></script>
    <script>
        const defaultConfig = {
            tagline: "G·ª≠i trao y√™u th∆∞∆°ng ‚Äì Nh·∫≠n l·ªôc an khang",
            main_heading: "Ng∆∞·ªùi trao ƒëang g·ª≠i l·ªôc xu√¢n cho..?",
            footer_text: "L·ªôc Xu√¢n 2026",
            background_color: "#1a0a0a",
            card_color: "#8B0000",
            text_color: "#FFF8DC",
            gold_color: "#FFD700",
            accent_color: "#B22222",
        };

        // ===== DEBUG MODE =====
        const DEBUG_MODE = false; // ƒê·ªïi th√†nh false khi deploy production
        // ======================

        let selectedRecipient = null;
        let isModalOpen = false; 
        const recipientNames = {
            "ong-ba": "√îng B√†",
            "bo-me": "B·ªë M·∫π",
            "anh-chi-em": "Anh Ch·ªã Em",
            "con-cai": "Con C√°i",
            "ban-be": "B·∫°n B√®",
            "dong-nghiep": "ƒê·ªìng Nghi·ªáp",
            "thay-co": "Th·∫ßy C√¥",
            "nguoi-thuong": "Ng∆∞·ªùi Th∆∞∆°ng",
        };
        const recipientIcons = {
            "ong-ba": "üë¥üëµ",
            "bo-me": "üë®‚Äçüë©‚Äçüëß",
            "anh-chi-em": "üë´",
            "con-cai": "üë∂",
            "ban-be": "ü§ù",
            "dong-nghiep": "üíº",
            "thay-co": "üìö",
            "nguoi-thuong": "üíï",
        };


        // Card selection logic
        document.querySelectorAll(".card-envelope").forEach((card) => {
            card.addEventListener("click", function () {
                // Remove selection from all cards
                document.querySelectorAll(".card-envelope").forEach((c) => {
                    c.classList.remove("selected-card");
                });

                // Add selection to clicked card
                this.classList.add("selected-card");
                selectedRecipient = this.dataset.recipient;

                // Show selection display
                const selectionDisplay = document.getElementById("selection-display");
                const selectedName = document.getElementById("selected-name");
                const continueBtn = document.getElementById("continue-btn");

                selectedName.textContent = recipientNames[selectedRecipient];
                selectionDisplay.classList.remove("hidden");
                continueBtn.classList.remove("hidden");
            });
        });

        // Continue button click - Show 24 envelopes
        document.getElementById("continue-btn").addEventListener("click", function () {
            if (!selectedRecipient) return;

            // ·∫®n ph·∫ßn ch·ªçn recipient
            document.querySelector(".grid.grid-cols-2").classList.add("hidden");
            document.getElementById("selection-display").classList.add("hidden");
            this.classList.add("hidden");

            // Hi·ªán envelopes container
            const envelopesContainer = document.getElementById("envelopes-container");
            envelopesContainer.classList.remove("hidden");

            const envelopesGrid = document.getElementById("envelopes-grid");
            envelopesGrid.innerHTML = "";

            // Key l∆∞u tr·ªØ ri√™ng cho t·ª´ng recipient
            const storageKey = `envelopeAmounts_${selectedRecipient}`;

            // L·∫•y b·ªô m·ªánh gi√° ƒë√£ l∆∞u (n·∫øu c√≥)
            let amounts = JSON.parse(localStorage.getItem(storageKey));

            // N·∫øu ch∆∞a c√≥ ho·∫∑c kh√¥ng ƒë·ªß TOTAL_ENVELOPES ‚Üí t·∫°o m·ªõi 1 l·∫ßn
            if (!amounts || amounts.length !== TOTAL_ENVELOPES) {
                amounts = generateFixedAmountsForRecipient(selectedRecipient);
                localStorage.setItem(storageKey, JSON.stringify(amounts));
                console.log(`T·∫°o m·ªõi b·ªô ${TOTAL_ENVELOPES} m·ªánh gi√° c·ªë ƒë·ªãnh cho ${selectedRecipient}`);
            } else {
                console.log(`S·ª≠ d·ª•ng b·ªô m·ªánh gi√° ƒë√£ l∆∞u cho ${selectedRecipient}`);
            }

            // T·∫°o TOTAL_ENVELOPES envelope v√† g√°n m·ªánh gi√° c·ªë ƒë·ªãnh
            for (let i = 1; i <= TOTAL_ENVELOPES; i++) {
                const envelope = createEnvelope(i);
                
                // G√°n m·ªánh gi√° c·ªë ƒë·ªãnh v√†o data attribute
                envelope.dataset.fixedAmount = amounts[i - 1];
                
                // (T√πy ch·ªçn) Th√™m data-number ƒë·ªÉ d·ªÖ l·∫•y sau
                envelope.dataset.number = i;
                envelope.dataset.opened = "false";
                
                // Th√™m ph·∫ßn t·ª≠ hi·ªÉn th·ªã m·ªánh gi√°
                const amountDisplay = document.createElement('div');
                amountDisplay.className = 'amount-display';
                amountDisplay.textContent = new Intl.NumberFormat('vi-VN').format(amounts[i - 1]);
                envelope.appendChild(amountDisplay);
                
                envelopesGrid.appendChild(envelope);
            }
        });
        
        // N√∫t X√°o tr·ªôn l·∫°i b·ªô m·ªánh gi√°
        document.getElementById("continue-btn").addEventListener("click", function () {
            if (!selectedRecipient) return;

            // ·∫®n ph·∫ßn ch·ªçn recipient
            document.querySelector(".grid.grid-cols-2").classList.add("hidden");
            document.getElementById("selection-display").classList.add("hidden");
            this.classList.add("hidden");

            // Hi·ªán envelopes container
            const envelopesContainer = document.getElementById("envelopes-container");
            envelopesContainer.classList.remove("hidden");

            const envelopesGrid = document.getElementById("envelopes-grid");
            envelopesGrid.innerHTML = "";

            const storageKey = `envelopeAmounts_${selectedRecipient}`;

            // LU√îN T·∫†O B·ªò M·ªöI M·ªñI L·∫¶N CONTINUE (x√°o tr·ªôn l·∫°i)
            const amounts = generateFixedAmountsForRecipient(selectedRecipient);
            localStorage.setItem(storageKey, JSON.stringify(amounts));
            console.log(`[ALWAYS NEW] ƒê√£ t·∫°o/x√°o tr·ªôn l·∫°i b·ªô ${TOTAL_ENVELOPES} m·ªánh gi√° m·ªõi cho ${selectedRecipient} (m·ªói l·∫ßn continue)`);

            // T·∫°o TOTAL_ENVELOPES envelope v·ªõi m·ªánh gi√° m·ªõi
            for (let i = 1; i <= TOTAL_ENVELOPES; i++) {
                const envelope = createEnvelope(i);
                envelope.dataset.fixedAmount = amounts[i - 1];
                envelope.dataset.number = i;
                envelope.dataset.opened = "false";
                
                // Th√™m ph·∫ßn t·ª≠ hi·ªÉn th·ªã m·ªánh gi√°
                const amountDisplay = document.createElement('div');
                amountDisplay.className = 'amount-display';
                amountDisplay.textContent = new Intl.NumberFormat('vi-VN').format(amounts[i - 1]);
                envelope.appendChild(amountDisplay);
                
                envelopesGrid.appendChild(envelope);
            }
        });

        // Show/Hide Amounts button
        document.getElementById("show-amounts-btn").addEventListener("click", function () {
            const envelopesGrid = document.getElementById("envelopes-grid");
            const amountDisplays = document.querySelectorAll(".amount-display");
            
            // Toggle class cho grid
            envelopesGrid.classList.toggle("show-amounts");
            
            // Toggle class cho t·ª´ng amount display
            amountDisplays.forEach(display => {
                display.classList.toggle("show");
            });
            
            // ƒê·ªïi text button
            const btn = document.getElementById("show-amounts-btn");
            if (envelopesGrid.classList.contains("show-amounts")) {
                btn.textContent = "üôà ·∫®n m·ªánh gi√°";
            } else {
                btn.textContent = "üí∞ Hi·ªán m·ªánh gi√°";
            }
        });

        // Reshuffle button
        // Reshuffle button - THU V√ÄO GI·ªÆA ‚Üí PH√ìNG RA
       // Reshuffle button - ƒê∆†N GI·∫¢N CHO MOBILE
        document.getElementById("reshuffle-envelopes").addEventListener("click", function () {
            if (!selectedRecipient) return;
            
            const envelopesGrid = document.getElementById("envelopes-grid");
            const existingEnvelopes = Array.from(document.querySelectorAll('.envelope-item'));
            
            if (existingEnvelopes.length === 0) return;
            
            // Disable n√∫t
            const btn = this;
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.textContent = 'üåÄ ƒêang x√°o...';
            
            // T·∫°o v√≤ng ·ªü gi·ªØa
            const vortex = document.createElement('div');
            vortex.className = 'shuffle-vortex';
            document.body.appendChild(vortex);
            
            // T√≠nh center
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // Thu v√†o gi·ªØa - T·ª™NG L√Å M·ªòT
            existingEnvelopes.forEach((env, index) => {
                const rect = env.getBoundingClientRect();
                const deltaX = centerX - (rect.left + rect.width / 2);
                const deltaY = centerY - (rect.top + rect.height / 2);
                
                env.style.setProperty('--center-x', `${deltaX}px`);
                env.style.setProperty('--center-y', `${deltaY}px`);
                
                // ‚ú® STAGGER: M·ªói l√° delay th√™m 30ms
                env.style.animationDelay = `${index * 100}ms`;
                env.classList.add('shuffling-center');
            });
            
            // T·ªïng th·ªùi gian = animation (800ms) + delay cu·ªëi c√πng (23 * 30ms = 690ms)
            const totalDuration = 800 + (existingEnvelopes.length - 1) * 100;
            
            // Sau khi THU V√ÄO XONG (50% c·ªßa animation) ‚Üí Update m·ªánh gi√°
            setTimeout(() => {
                const storageKey = `envelopeAmounts_${selectedRecipient}`;
                const amounts = generateFixedAmountsForRecipient(selectedRecipient);
                localStorage.setItem(storageKey, JSON.stringify(amounts));
                
                existingEnvelopes.forEach((env, index) => {
                    env.dataset.fixedAmount = amounts[index];
                    const amountDisplay = env.querySelector('.amount-display');
                    if (amountDisplay) {
                        amountDisplay.textContent = new Intl.NumberFormat('vi-VN').format(amounts[index]);
                    }
                });
                
                console.log('üåÄ ƒê√£ update m·ªánh gi√° m·ªõi');
            }, totalDuration * 0.5); // 50% c·ªßa total time
            
            // Sau animation HO√ÄN TO√ÄN XONG ‚Üí Cleanup
            setTimeout(() => {
                // Remove animation class v√† reset tr·∫°ng th√°i "ƒë√£ m·ªü"
                existingEnvelopes.forEach(env => {
                    env.classList.remove('shuffling-center');
                    env.classList.remove('opened');
                    env.classList.remove('clicked');
                    env.dataset.opened = 'false';
                    env.style.animationDelay = '';
                });
                
                // Flash s·ªë ti·ªÅn - T·ª™NG L√Å M·ªòT
                existingEnvelopes.forEach((env, index) => {
                    setTimeout(() => {
                        const amountDisplay = env.querySelector('.amount-display');
                        if (amountDisplay && envelopesGrid.classList.contains('show-amounts')) {
                            amountDisplay.style.transition = 'color 0.3s ease, transform 0.3s ease';
                            amountDisplay.style.color = '#FFD700';
                            amountDisplay.style.transform = 'scale(1.2)';
                            amountDisplay.style.fontWeight = 'bold';
                            
                            setTimeout(() => {
                                amountDisplay.style.color = '';
                                amountDisplay.style.transform = 'scale(1)';
                                amountDisplay.style.fontWeight = '';
                            }, 300);
                        }
                    }, index * 20); // Flash t·ª´ng l√° sau 20ms
                });
                
                vortex.remove();
                
                // Re-enable n√∫t
                setTimeout(() => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.textContent = 'üîÑ X√°o tr·ªôn';
                }, 500);
                
            }, totalDuration + 100); // Th√™m 100ms buffer
        });


        // Back button - Return to main selection
        document
            .getElementById("back-btn")
            .addEventListener("click", function () {
                // Reset tr·∫°ng th√°i "ƒë√£ m·ªü" khi quay v·ªÅ
                const envelopes = document.querySelectorAll(".envelope-item");
                envelopes.forEach(env => {
                    env.classList.remove('opened');
                    env.dataset.opened = "false";
                });
                
                // Hide envelopes container
                document
                    .getElementById("envelopes-container")
                    .classList.add("hidden");

                // Show main content
                document
                    .querySelector(".grid.grid-cols-2")
                    .classList.remove("hidden");
                document
                    .getElementById("selection-display")
                    .classList.remove("hidden");
                document.getElementById("continue-btn").classList.remove("hidden");
            });

            // X√°o tr·ªôn m·∫£ng (Fisher-Yates shuffle)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // T·∫°o b·ªô 24 m·ªánh gi√° c·ªë ƒë·ªãnh d·ª±a tr√™n setting c·ªßa recipient
            function generateFixedAmountsForRecipient(recipientKey) {
                const settings = getEnvelopeSettingsFor(recipientKey);
                let pool = [];

                // Th√™m c√°c custom specials (n·∫øu c√≥)
                if (settings.customSpecials && settings.customSpecials.length > 0) {
                    settings.customSpecials.forEach(cs => {
                        for (let j = 0; j < cs.count; j++) {
                            pool.push(cs.amount);
                        }
                    });
                }

                // Th√™m bao ƒë·∫∑c bi·ªát ch√≠nh
                for (let j = 0; j < settings.specialCount; j++) {
                    pool.push(settings.specialAmount);
                }

                // ƒêi·ªÅn c√≤n l·∫°i b·∫±ng bao th∆∞·ªùng (random trong min-max)
                const remaining = TOTAL_ENVELOPES - pool.length;
                for (let j = 0; j < remaining; j++) {
                    // Random tr√≤n ch·ª•c trong min-max
                    const normal = getRandomTronChuc(settings.min, settings.max);
                    pool.push(normal);
                    // 
                }

                // X√°o tr·ªôn ƒë·ªÉ ph√¢n b·ªë ng·∫´u nhi√™n
                shuffleArray(pool);

                return pool; // m·∫£ng 24 s·ªë
            }

        // =========== PH·∫¶N T·∫†O BAO L√å X√å M·ªöI ===========
        const luckyMessages = [
            "Ph√°t T√†i Ph√°t L·ªôc",
            "V·∫°n S·ª± Nh∆∞ √ù",
            "An Khang Th·ªãnh V∆∞·ª£ng",
            "T√†i L·ªôc D·ªìi D√†o",
            "S·ª©c Kh·ªèe D·ªìi D√†o",
            "H·∫°nh Ph√∫c Vi√™n M√£n",
            "C√¥ng Th√†nh Danh To·∫°i",
            "M√£ ƒê√°o Th√†nh C√¥ng",
            "Kim Ng·ªçc M√£n ƒê∆∞·ªùng",
            "Ph√∫c L·ªôc Song To√†n",
            "Thu·∫≠n Bu·ªìm Xu√¥i Gi√≥",
            "B√¨nh An H·∫°nh Ph√∫c",
        ];

        const luckySymbols = ["Á¶è", "Á¶Ñ", "ÂØø", "Âñú", "Ë≤°", "Âêâ", "Á••", "Áôº"];

        // Bi·∫øn global ƒë·ªÉ qu·∫£n l√Ω timeout cho t·∫•t c·∫£ envelopes
        let globalClickTimeout = null;
        let lastClickedEnvelope = null;

        function createEnvelope(number) {
            const envelope = document.createElement("div");
            envelope.className = "envelope-item";

            const luckyMessage = luckyMessages[(number - 1) % luckyMessages.length];
            const luckySymbol = luckySymbols[(number - 1) % luckySymbols.length];

            // X√°c ƒë·ªãnh lo·∫°i l√¨ x√¨ d·ª±a tr√™n s·ªë th·ª© t·ª±
            const envelopeTypes = [
                "", // M√†u ƒë·ªè truy·ªÅn th·ªëng
                "envelope-blue", // Xanh d∆∞∆°ng
                "envelope-gold-light", // Xanh l√°
                "envelope-purple", // T√≠m
                "envelope-gold", // V√†ng ƒë·∫≠m
                "",
                // t·ª´ng row
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
                "envelope-gold",
                "",
                "envelope-blue",
                "envelope-gold-light",
                "envelope-purple",
            ];

            const envelopeType = envelopeTypes[(number - 1) % envelopeTypes.length];

            // X√°c ƒë·ªãnh lo·∫°i seal
            let sealClass = "gold-seal";
            if (number % 3 === 0) {
                sealClass = "gold-seal silver-seal";
            } else if (number % 5 === 0) {
                sealClass = "gold-seal bronze-seal";
            }

            envelope.innerHTML = `
                <div class="envelope-body">
                    <div class="pattern-overlay"></div>
                    <div class="shimmer"></div>
                    
                    <!-- Corner Decorations -->
                    <div class="corner-decor top-left"></div>
                    <div class="corner-decor top-right"></div>
                    <div class="corner-decor bottom-left"></div>
                    <div class="corner-decor bottom-right"></div>
                    
                    <!-- Flower Decorations -->
                    <div class="flower-decor flower-top-left">üå∏</div>
                    <div class="flower-decor flower-top-right">üå∏</div>
                    <div class="flower-decor flower-bottom-left">üå∏</div>
                    <div class="flower-decor flower-bottom-right">üå∏</div>
                    
                    <!-- Ornamental Bands -->
                    <div class="ornament-pattern ornament-top"></div>
                    <div class="ornament-pattern ornament-bottom"></div>
                    
                    <!-- Wave Patterns -->
                    <div class="wave-pattern wave-top"></div>
                    <div class="wave-pattern wave-bottom"></div>
                    
                    <!-- Diamond Patterns -->
                    <div class="diamond-pattern diamond-1"></div>
                    <div class="diamond-pattern diamond-2"></div>
                    <div class="diamond-pattern diamond-3"></div>
                    <div class="diamond-pattern diamond-4"></div>
                    
                    <!-- Lantern Decorations -->
                    <div class="lantern-decor lantern-left">üèÆ</div>
                    <div class="lantern-decor lantern-right">üèÆ</div>
                    
                    <!-- Gold Dots -->
                    <div class="gold-dots" style="top: 28%; left: 25%;"></div>
                    <div class="gold-dots" style="top: 28%; right: 25%;"></div>
                    <div class="gold-dots" style="top: 40%; left: 20%;"></div>
                    <div class="gold-dots" style="top: 40%; right: 20%;"></div>
                    <div class="gold-dots" style="bottom: 28%; left: 25%;"></div>
                    <div class="gold-dots" style="bottom: 28%; right: 25%;"></div>
                    <div class="gold-dots" style="bottom: 40%; left: 20%;"></div>
                    <div class="gold-dots" style="bottom: 40%; right: 20%;"></div>
                    
                    <!-- Cloud Patterns -->
                    <div class="cloud-pattern cloud-1"></div>
                    <div class="cloud-pattern cloud-2"></div>
                    
                    <!-- Lucky Knot -->
                    <div class="lucky-knot"></div>
                    
                    <!-- Top Flap -->
                    <div class="envelope-flap"></div>
                    
                    <!-- Gold Seal -->
                    <div class="${sealClass}">
                        <span class="seal-text">${luckySymbol}</span>
                    </div>
                    
                    <!-- Lucky Message -->
                    <div class="lucky-message">${luckyMessage}</div>
                    
                    <!-- Number Badge -->
                    <div class="envelope-number">L√¨ X√¨ #${number}</div>
                </div>
            `;

            // Th√™m l·ªõp m√†u cho envelope
            if (envelopeType) {
                envelope.classList.add(envelopeType);
            }



            envelope.addEventListener("click", function () {
                // H·ªßy timeout tr∆∞·ªõc ƒë√≥ n·∫øu c√≥
                if (globalClickTimeout) {
                    clearTimeout(globalClickTimeout);
                }
                
                // X√≥a hi·ªáu ·ª©ng clicked c·ªßa envelope tr∆∞·ªõc ƒë√≥
                if (lastClickedEnvelope && lastClickedEnvelope !== this) {
                    lastClickedEnvelope.classList.remove("clicked");
                }
                
                // Th√™m hi·ªáu ·ª©ng clicked cho envelope hi·ªán t·∫°i
                this.classList.add("clicked");
                lastClickedEnvelope = this;
                
                // L∆∞u reference
                const currentEnvelope = this;
                const currentNumber = number;
                
                // ƒê·∫∑t timeout m·ªõi
                globalClickTimeout = setTimeout(() => {
                    currentEnvelope.classList.remove("clicked");
                    
                    // Ch·ªâ hi·ªán confirm cho l·∫ßn click cu·ªëi c√πng
                    // if (confirm("B·∫°n ƒë√£ ch·∫Øc ch·∫Øn mu·ªën nh·∫≠n bao l√¨ x√¨ #" + currentNumber + " n√†y ch·ª©?")) {
                        console.log("ƒê√£ ch·ªçn l√¨ x√¨ #" + currentNumber);
                        
                        // M·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n
                        openHeartLetterModal(currentNumber);
                    // }
                    
                    globalClickTimeout = null;
                    lastClickedEnvelope = null;
                }, 500);
            });

            return envelope;
        }
        // =========== END PH·∫¶N T·∫†O BAO L√å X√å M·ªöI ===========

        // H√†m m·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n
        // H√†m m·ªü modal V·ªè Thi·ªáp (Cover)
        function openHeartLetterModal(envelopeNumber) {
             // L∆∞u envelope number v√†o bi·∫øn global ƒë·ªÉ d√πng sau
            window.currentEnvelopeNumber = envelopeNumber;
            
            // Hi·ªán modal v·ªè thi·ªáp
            const coverModal = document.getElementById('card-cover-modal');
            coverModal.classList.remove('hidden');
            
            // Update t√™n ng∆∞·ªùi g·ª≠i trong t√¢m th∆∞
            const senderDisplay = document.getElementById('sender-name-display');
            if (senderDisplay && senderName) {
                senderDisplay.textContent = senderName;
            }
        }

        // ===== ƒê√ìNG V·ªé THI·ªÜP (X ho·∫∑c click overlay) =====
        // ƒê√≥ng khi click n√∫t X
        document.getElementById('close-card-cover-btn').addEventListener('click', function() {
            const coverModal = document.getElementById('card-cover-modal');
            coverModal.style.opacity = '0';
            coverModal.style.transition = 'opacity 0.3s ease';
            
            setTimeout(() => {
                coverModal.classList.add('hidden');
                coverModal.style.opacity = '1';
            }, 300);
            
            console.log('‚ùå ƒê√≥ng v·ªè thi·ªáp (ch∆∞a ƒë√°nh d·∫•u ƒë√£ m·ªü)');
        });

        // ƒê√≥ng khi click overlay (v√πng t·ªëi b√™n ngo√†i)
        document.getElementById('card-cover-overlay').addEventListener('click', function() {
            document.getElementById('close-card-cover-btn').click();
        });

        // H√†m kh·ªüi t·∫°o canvas c√†o l√¨ x√¨
        function initScratchCard(envelopeNumber) {
            const canvas = document.getElementById('scratch-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const scratchArea = document.getElementById('scratch-area');
            const moneyDisplay = document.getElementById('money-display');

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // L·∫§Y M·ªÜNH GI√Å C·ªê ƒê·ªäNH (ƒë√£ random 1 l·∫ßn tr∆∞·ªõc ƒë√≥)
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const envelopeElement = document.querySelector(`.envelope-item[data-number="${envelopeNumber}"]`);
            let amount = 0;

            if (envelopeElement && envelopeElement.dataset.fixedAmount) {
                amount = parseInt(envelopeElement.dataset.fixedAmount, 10) || 0;
            }

            // N·∫øu kh√¥ng t√¨m th·∫•y (l·ªói hi·∫øm g·∫∑p) ‚Üí fallback v·ªÅ 0 ho·∫∑c gi√° tr·ªã m·∫∑c ƒë·ªãnh
            if (amount <= 0) {
                amount = 0;
                console.warn(`Kh√¥ng t√¨m th·∫•y m·ªánh gi√° c·ªë ƒë·ªãnh cho bao #${envelopeNumber}`);
            }

            moneyDisplay.textContent = `üéâ ${formatVND(amount)} üéâ`;

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // Ph·∫ßn c√≤n l·∫°i gi·ªØ nguy√™n: v·∫Ω canvas + s·ª± ki·ªán c√†o
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            // Thi·∫øt l·∫≠p k√≠ch th∆∞·ªõc canvas
            canvas.width = scratchArea.offsetWidth;
            canvas.height = scratchArea.offsetHeight;

            // V·∫Ω l·ªõp ph·ªß v√†ng
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, '#DAA520');
            gradient.addColorStop(0.5, '#FFD700');
            gradient.addColorStop(1, '#DAA520');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Th√™m text "C√ÄO ƒê·ªÇ XEM L·ªòC XU√ÇN"
            ctx.fillStyle = '#8B0000';
            ctx.font = 'bold 14px "Be Vietnam Pro", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('C√ÄO ƒê·ªÇ XEM L·ªòC XU√ÇN', canvas.width / 2, canvas.height / 2);

            let isScratching = false;
            let lastX = 0;
            let lastY = 0;

            // H√†m c√†o
            function scratch(x, y) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();

                // V·∫Ω ƒë∆∞·ªùng n·ªëi gi·ªØa c√°c ƒëi·ªÉm
                if (lastX && lastY) {
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(x, y);
                    ctx.lineWidth = 40;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }

                lastX = x;
                lastY = y;
            }

            // L·∫•y v·ªã tr√≠ chu·ªôt/touch
            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                return { x, y };
            }

            // S·ª± ki·ªán chu·ªôt
            canvas.addEventListener('mousedown', (e) => {
                isScratching = true;
                const pos = getPosition(e);
                scratch(pos.x, pos.y);
            });

            canvas.addEventListener('mousemove', (e) => {
                if (isScratching) {
                    const pos = getPosition(e);
                    scratch(pos.x, pos.y);
                }
            });

            canvas.addEventListener('mouseup', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });

            canvas.addEventListener('mouseleave', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });

            // S·ª± ki·ªán touch (mobile)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isScratching = true;
                const pos = getPosition(e);
                scratch(pos.x, pos.y);
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (isScratching) {
                    const pos = getPosition(e);
                    scratch(pos.x, pos.y);
                }
            });

            canvas.addEventListener('touchend', () => {
                isScratching = false;
                lastX = 0;
                lastY = 0;
            });

            // Force canvas l√™n tr√™n c√πng
            canvas.style.position = 'absolute';
            canvas.style.zIndex = '10';
            canvas.style.pointerEvents = 'auto';
        }


        // X·ª≠ l√Ω ƒë√≥ng modal - ƒê·∫∂T NGO√ÄI H√ÄM openHeartLetterModal
        // X·ª≠ l√Ω ƒë√≥ng modal letter
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('heart-letter-modal').classList.add('hidden');
        });

        // ƒê√≥ng modal khi click overlay
        document.getElementById('heart-letter-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // ===== M·ªû THI·ªÜP ‚Üí ·∫®N COVER =====
        // ===== M·ªû THI·ªÜP ‚Üí ƒê√ìNG COVER ‚Üí M·ªû LETTER =====
        // ===== M·ªû THI·ªÜP ‚Üí ƒê√ìNG COVER ‚Üí M·ªû LETTER =====
        document.getElementById('open-card-btn').addEventListener('click', function () {
            const coverModal = document.getElementById('card-cover-modal');
            const letterModal = document.getElementById('heart-letter-modal');
            
            // ‚úÖ ƒê√ÅNH D·∫§U "ƒê√É M·ªû" KHI CLICK "M·ªû THI·ªÜP"
            if (window.currentEnvelopeNumber) {
                const envelopeElement = document.querySelector(`.envelope-item[data-number="${window.currentEnvelopeNumber}"]`);
                if (envelopeElement && envelopeElement.dataset.opened !== "true") {
                    envelopeElement.classList.add('opened');
                    envelopeElement.dataset.opened = "true";
                    console.log(`‚úÖ ƒê√£ ƒë√°nh d·∫•u l√¨ x√¨ #${window.currentEnvelopeNumber} l√† "ƒë√£ m·ªü"`);
                }
            }
            
            // Fade out cover modal
            coverModal.style.opacity = '0';
            coverModal.style.transition = 'opacity 0.4s ease';
            
            setTimeout(() => {
                // ƒê√≥ng cover modal
                coverModal.classList.add('hidden');
                coverModal.style.opacity = '1'; // Reset opacity cho l·∫ßn sau
                
                // M·ªü letter modal
                letterModal.classList.remove('hidden');
                
                // Kh·ªüi t·∫°o scratch card v·ªõi envelope number ƒë√£ l∆∞u
                if (window.currentEnvelopeNumber) {
                    initScratchCard(window.currentEnvelopeNumber);
                }
            }, 400);
        });


        // ƒê√≥ng modal khi click overlay
        document.getElementById('heart-letter-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
        // end H√†m m·ªü modal T√¢m Th∆∞ & L·ªôc Xu√¢n

        // =========== AUTO SHOW 24 ENVELOPES FOR TESTING ===========
        if (DEBUG_MODE) {
            window.addEventListener('DOMContentLoaded', function() {
                // ·∫®n ph·∫ßn ch·ªçn ng∆∞·ªùi nh·∫≠n
                document.querySelector(".grid.grid-cols-2").classList.add("hidden");
                document.getElementById("selection-display").classList.add("hidden");
                document.getElementById("continue-btn").classList.add("hidden");
                
                // Hi·ªÉn th·ªã container TOTAL_ENVELOPES bao l√¨ x√¨
                const envelopesContainer = document.getElementById("envelopes-container");
                envelopesContainer.classList.remove("hidden");
                
                // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ v·ªõi s·ªë l∆∞·ª£ng l√¨ x√¨
                document.getElementById('total-envelopes-count').textContent = TOTAL_ENVELOPES;
                
                // T·∫°o TOTAL_ENVELOPES bao l√¨ x√¨
                const envelopesGrid = document.getElementById("envelopes-grid");
                envelopesGrid.innerHTML = "";
                
                for (let i = 1; i <= TOTAL_ENVELOPES; i++) {
                    envelopesGrid.appendChild(createEnvelope(i));
                }
                
                // Set selectedRecipient ƒë·ªÉ n√∫t Back v·∫´n ho·∫°t ƒë·ªông
                selectedRecipient = "test-mode";
            });
        }
        // =========== END AUTO SHOW ===========


        // Element SDK initialization
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById("tagline").textContent =
                        config.tagline || defaultConfig.tagline;
                    document.getElementById("main-heading").textContent =
                        config.main_heading || defaultConfig.main_heading;
                    document.getElementById("footer-text").textContent =
                        config.footer_text || defaultConfig.footer_text;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () =>
                                config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            },
                        },
                        {
                            get: () => config.card_color || defaultConfig.card_color,
                            set: (value) => {
                                config.card_color = value;
                                window.elementSdk.setConfig({ card_color: value });
                            },
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            },
                        },
                        {
                            get: () => config.gold_color || defaultConfig.gold_color,
                            set: (value) => {
                                config.gold_color = value;
                                window.elementSdk.setConfig({ gold_color: value });
                            },
                        },
                        {
                            get: () => config.accent_color || defaultConfig.accent_color,
                            set: (value) => {
                                config.accent_color = value;
                                window.elementSdk.setConfig({ accent_color: value });
                            },
                        },
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined,
                }),
                mapToEditPanelValues: (config) =>
                    new Map([
                        ["tagline", config.tagline || defaultConfig.tagline],
                        [
                            "main_heading",
                            config.main_heading || defaultConfig.main_heading,
                        ],
                        ["footer_text", config.footer_text || defaultConfig.footer_text],
                    ]),
            });
        }
    </script>


    <script>
        // ===== X·ª¨ L√ù T√äN NG∆Ø·ªúI G·ª¨I =====
        let senderName = '';

        // Load t√™n t·ª´ URL ho·∫∑c localStorage
        function loadSenderName() {
            const urlParams = new URLSearchParams(window.location.search);
            const nameFromURL = urlParams.get('name');
            
            if (nameFromURL) {
                senderName = decodeURIComponent(nameFromURL);
                localStorage.setItem('senderName', senderName);
                document.getElementById('name-form-wrapper').classList.add('hidden');
                showSenderBadge(); // Hi·ªán badge
                return true;
            }
            
            const nameFromStorage = localStorage.getItem('senderName');
            if (nameFromStorage) {
                senderName = nameFromStorage;
                document.getElementById('name-form-wrapper').classList.add('hidden');
                showSenderBadge(); // Hi·ªán badge
                return true;
            }
            
            return false;
        }

        // Hi·ªÉn th·ªã badge v·ªõi t√™n
        function showSenderBadge() {
            const badge = document.getElementById('sender-badge');
            const badgeName = document.getElementById('sender-badge-name');
            
            if (senderName && badge && badgeName) {
                badgeName.textContent = senderName;
                badge.classList.remove('hidden');
                
                // Animation fade in
                badge.style.opacity = '0';
                badge.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    badge.style.transition = 'all 0.5s ease';
                    badge.style.opacity = '1';
                    badge.style.transform = 'translateX(0)';
                }, 100);
            }
        }

        // ·∫®n badge
        function hideSenderBadge() {
            const badge = document.getElementById('sender-badge');
            if (badge) {
                badge.style.opacity = '0';
                badge.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    badge.classList.add('hidden');
                }, 300);
            }
        }

        // Click v√†o badge ‚Üí M·ªü form s·ª≠a t√™n
        document.getElementById('sender-badge').addEventListener('click', function() {
            hideSenderBadge();
            
            // Hi·ªán form v·ªõi t√™n hi·ªán t·∫°i
            const nameForm = document.getElementById('name-form-wrapper');
            const input = document.getElementById('sender-name');
            const btn = document.getElementById('confirm-name-btn');
            
            nameForm.classList.remove('hidden');
            input.value = senderName;
            input.focus();
            btn.disabled = false;
            
            console.log('üñäÔ∏è M·ªü form s·ª≠a t√™n');
        });

        // Enable/disable button khi nh·∫≠p
        document.getElementById('sender-name').addEventListener('input', function(e) {
            const btn = document.getElementById('confirm-name-btn');
            const value = e.target.value.trim();
            
            if (value.length >= 2) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        });

        // X·ª≠ l√Ω khi nh·∫•n Enter
        document.getElementById('sender-name').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('confirm-name-btn').disabled) {
                document.getElementById('confirm-name-btn').click();
            }
        });

        // X√°c nh·∫≠n t√™n
        document.getElementById('confirm-name-btn').addEventListener('click', function() {
            const input = document.getElementById('sender-name');
            senderName = input.value.trim();
            
            if (senderName.length < 2) return;
            
            // L∆∞u v√†o localStorage
            localStorage.setItem('senderName', senderName);
            
            // Update URL v·ªõi t√™n
            const url = new URL(window.location);
            url.searchParams.set('name', encodeURIComponent(senderName));
            window.history.replaceState({}, '', url);
            
            // ·∫®n form
            const nameForm = document.getElementById('name-form-wrapper');
            nameForm.style.transition = 'opacity 0.3s ease';
            nameForm.style.opacity = '0';
            
            setTimeout(() => {
                nameForm.classList.add('hidden');
                nameForm.style.opacity = '1';
                
                // Hi·ªán badge
                showSenderBadge();
            }, 300);
            
            console.log('‚úÖ ƒê√£ l∆∞u t√™n ng∆∞·ªùi g·ª≠i:', senderName);
        });

        // Load t√™n khi page load
        window.addEventListener('DOMContentLoaded', function() {
            loadSenderName();
        });

        // ===== END X·ª¨ L√ù T√äN NG∆Ø·ªúI G·ª¨I =====
    </script>
    
</body>

</html>